var jsonPrototype = 
  [{ "tl_ID" : "1",
     "tl_title" : "Overskrift en to tre yeah",
     "tl_ingress": "Lorem Ipsum har vært bransjens standard for dummytekst helt siden 1500-tallet, da en ukjent boktrykker stokket en mengde bokstaver for å lage et prøveeksemplar av en bok. Lorem Ipsum har tålt tidens tann usedvanlig godt, og har i tillegg til å bestå gjennom fem århundrer også tålt spranget over til elektronisk typografi uten vesentlige endringer. Lorem Ipsum ble gjort allment kjent i 1960-årene ved lanseringen av Letraset-ark med avsnitt fra Lorem Ipsum, og senere med sideombrekkingsprogrammet Aldus PageMaker som tok i bruk nettopp Lorem Ipsum for dummytekst.",
     "categories":[
            {
               "category1":"Kategori1",
               "category2":"Kategori2",
               "category3":"Kategori3",
               "category4":"Kategori4",
               "category5":"Kategori5",
               "category6":"Kategori6",
               "color1":"#00aeef",
               "color2":"#8dc63f",
               "color3":"#5b57a6",
               "color4":"#ed1c24",
               "color5":"#0072bc",
               "color6":"#f7941d"
            }
         ],
     "tl_content":  [{
                  "content_ID": "5",
                  "tl_ID": "1",
                  "content_time": "15:21:00",
                  "content_date": "2012-12-01",
                  "custom_time" : "0",
                  "content_category":"Kategori5",
                  "content_important" : "false",
                  "content_title": "Denne første overskriften er ganske lang og lenger skal den bli haha",
                  "content_content": "Donizzle shiznit auctizzle shiz. Phasellizzle funky fresh elit ut nibh pretium tincidunt. Uhuh ... yih! a erat. Vestibulizzle izzle uhuh ... yih! sed maurizzle i saw beyonces tizzles and my pizzle went crizzle tristique. Mah nizzle izzle phat sizzle amet eros shizznit porta. Yippiyo velizzle tortor, ultricizzle shiznit, hendrerizzle bow wow wow, adipiscing quis, hizzle. Shit velizzle sizzle, aliquam dang, pharetra dizzle, dictizzle bow wow wow, turpizzle. Donizzle shiznit auctizzle shiz. Phasellizzle funky fresh elit ut nibh pretium tincidunt. Uhuh ... yih! a erat. Vestibulizzle izzle uhuh ... yih! sed maurizzle i saw beyonces tizzles and my pizzle went crizzle tristique. Mah nizzle izzle phat sizzle amet eros shizznit porta. Yippiyo velizzle tortor, ultricizzle shiznit, hendrerizzle bow wow wow, adipiscing quis, hizzle. Shit velizzle sizzle, aliquam dang, pharetra dizzle, dictizzle bow wow wow, turpizzle.",
                  "content_media": "true",
                  "content_media_table":[{  
                                      "media_type":"picture",
                                      "media_text":"Donizzle shiznit auctizzle shiz. Phasellizzle funky fresh elit ut nibh pretium tincidunt. Uhuh ... yih!",
                                      "media_data":"img/1.jpg"
                                   },{
                                      "media_type":"picture",
                                      "media_text":"Bla2 bla2 bla2",
                                      "media_data":"img/2.jpg"
                                   },{
                                      "media_type":"map",
                                      "media_text":"Great map",
                                      "media_data":"59.91182,10.73427,16"
                                   },{
                                      "media_type":"nothing",
                                      "media_text":"Great video",
                                      "media_data":"http://aftenposten.no/embed?id=7127472&width=445&height=300"
                                   }]
                
                 },{
                  "content_ID": "6",
                  "tl_ID": "1",
                  "content_time": "23:21:00",
                  "content_date": "2012-12-02",
                  "custom_time" : "Desember-ish",
                  "content_category":"",
                  "content_important" : "true",
                  "content_title": "Gruppe 21 er awesome",
                  "content_content": "Donizzle shiznit auctizzle shiz. Phasellizzle funky fresh elit ut nibh pretium tincidunt. Uhuh ... yih! a erat. Vestibulizzle izzle uhuh ... yih! sed maurizzle i saw beyonces tizzles and my pizzle went crizzle tristique. Mah nizzle izzle phat sizzle amet eros shizznit porta. Yippiyo velizzle tortor, ultricizzle shiznit, hendrerizzle bow wow wow, adipiscing quis, hizzle. Shit velizzle sizzle, aliquam dang, pharetra dizzle, dictizzle bow wow wow, turpizzle.",
                  "content_media": "true",
                  "content_media_table":[{  
                                      "media_type":"picture",
                                      "media_text":"Donizzle shiznit auctizzle shiz. Phasellizzle funky fresh elit ut nibh pretium tincidunt. Uhuh ... yih!",
                                      "media_data":"img/d1.jpg"
                                   },{
                                      "media_type":"picture",
                                      "media_text":"Bla2 bla2 bla2",
                                      "media_data":"img/f1.jpg"
                                   },{
                                      "media_type":"map",
                                      "media_text":"Great map",
                                      "media_data":"39.69996,126.03771,16"
                                   },{
                                      "media_type":"picture",
                                      "media_text":"3",
                                      "media_data":"img/3.jpg"
                                   },{
                                      "media_type":"picture",
                                      "media_text":"4",
                                      "media_data":"img/4.jpg"
                                   },{
                                      "media_type":"picture",
                                      "media_text":"5",
                                      "media_data":"img/5.jpg"
                                   },{
                                      "media_type":"picture",
                                      "media_text":"6",
                                      "media_data":"img/6.jpg"
                                   },{
                                      "media_type":"picture",
                                      "media_text":"7",
                                      "media_data":"img/7.jpg"
                                   },{
                                      "media_type":"picture",
                                      "media_text":"a1",
                                      "media_data":"img/a1.jpg"
                                   },{
                                      "media_type":"picture",
                                      "media_text":"c1",
                                      "media_data":"img/c1.jpg"
                                   }]
                
                 },{
                  "content_ID": "7",
                  "tl_ID": "1",
                  "content_time": "18:21:00",
                  "content_date": "2012-12-03",
                  "custom_time" : "0",
                  "content_important" : "false",
                  "content_category":"Kategori5",
                  "content_title": "Kort hendelse",
                  "content_content": "Donizzle shiznit auctizzle shiz. Phasellizzle funky fresh elit ut nibh pretium tincidunt. ",
                  "content_media": "false",
                  "content_media_table":[{
                                   }]
                
                 },{
                  "content_ID": "7",
                  "tl_ID": "1",
                  "content_time": "15:04:00",
                  "content_date": "2012-12-04",
                  "custom_time" : "0",
                  "content_important" : "true",
                  "content_category":"Kategori4",
                  "content_title": "Kort hendelse",
                  "content_content": "Donizzle shiznit auctizzle shiz. Phasellizzle funky fresh elit ut nibh pretium tincidunt. ",
                  "content_media": "false",
                  "content_media_table":[{
                                   }]
                
                 },{
                  "content_ID": "7",
                  "tl_ID": "1",
                  "content_time": "15:05:00",
                  "content_date": "2012-12-05",
                  "custom_time" : "0",
                  "content_important" : "false",
                  "content_category":"",
                  "content_title": "Kort hendelse",
                  "content_content": "Donizzle shiznit auctizzle shiz. Phasellizzle funky fresh elit ut nibh pretium tincidunt. ",
                  "content_media": "false",
                  "content_media_table":[{
                                   }]
                
                 },{
                  "content_ID": "7",
                  "tl_ID": "1",
                  "content_time": "15:10:00",
                  "content_date": "2012-12-06",
                  "custom_time" : "0",
                  "content_important" : "false",
                  "content_category":"Kategori6",
                  "content_title": "Kort hendelse",
                  "content_content": "Donizzle shiznit auctizzle shiz. ",
                  "content_media": "false",
                  "content_media_table":[{
                                   }]
                
                 },{
                  "content_ID": "7",
                  "tl_ID": "1",
                  "content_time": "15:13:00",
                  "content_date": "2013-01-07",
                  "custom_time" : "0",
                  "content_important" : "false",
                  "content_category":"Kategori1",
                  "content_title": "Kort hendelse",
                  "content_content": "Donizzle shiznit auctizzle shiz. ",
                  "content_media": "false",
                  "content_media_table":[{
                                   }]
                
                 },{
                  "content_ID": "7",
                  "tl_ID": "1",
                  "content_time": "15:14:00",
                  "content_date": "2013-01-10",
                  "custom_time" : "0",
                  "content_important" : "false",
                  "content_category":"Kategori1",
                  "content_title": "Kort hendelse",
                  "content_content": "Donizzle shiznit auctizzle shiz. ",
                  "content_media": "false",
                  "content_media_table":[{
                                   }]
                
                 },{
                  "content_ID": "200",
                  "tl_ID": "1",
                  "content_time": "23:21:00",
                  "content_date": "2013-01-12",
                  "custom_time" : "Datoen er 12.01",
                  "content_category":"Kategori2",
                  "content_important" : "true",
                  "content_title": "Gruppe 21 er awesome",
                  "content_content": "Donizzle shiznit auctizzle shiz. Phasellizzle funky fresh elit ut nibh pretium tincidunt. Uhuh ... yih! a erat. Vestibulizzle izzle uhuh ... yih! sed maurizzle i saw beyonces tizzles and my pizzle went crizzle tristique. Mah nizzle izzle phat sizzle amet eros shizznit porta. Yippiyo velizzle tortor, ultricizzle shiznit, hendrerizzle bow wow wow, adipiscing quis, hizzle. Shit velizzle sizzle, aliquam dang, pharetra dizzle, dictizzle bow wow wow, turpizzle.",
                  "content_media": "true",
                  "content_media_table":[{  
                                      "media_type":"picture",
                                      "media_text":"Donizzle shiznit auctizzle shiz. Phasellizzle funky fresh elit ut nibh pretium tincidunt. Uhuh ... yih!",
                                      "media_data":""
                                   },{
                                      "media_type":"picture",
                                      "media_text":"Bla2 bla2 bla2",
                                      "media_data":""
                                   },{
                                      "media_type":"map",
                                      "media_text":"Great map",
                                      "media_data":"34.69996,126.03771,16"
                                   },{
                                      "media_type":"picture",
                                      "media_text":"Great video",
                                      "media_data":""
                                   }]
                
                 },{
                  "content_ID": "7",
                  "tl_ID": "1",
                  "content_time": "22:15:00",
                  "content_date": "2013-01-15",
                  "custom_time" : "0",
                  "content_important" : "false",
                  "content_category":"Kategori1",
                  "content_title": "Kort hendelse",
                  "content_content": "Donizzle shiznit auctizzle shiz. ",
                  "content_media": "false",
                  "content_media_table":[{
                                   }]
                
                 },{
                  "content_ID": "7",
                  "tl_ID": "1",
                  "content_time": "01:18:00",
                  "content_date": "2013-02-02",
                  "custom_time" : "0",
                  "content_important" : "false",
                  "content_category":"Kategori3",
                  "content_title": "Kort hendelse",
                  "content_content": "Donizzle shiznit auctizzle shiz. ",
                  "content_media": "false",
                  "content_media_table":[{
                                   }]
                
                 }],
  }];    //JSON you can use for testing.


var responsiveWidth = 800; //The max width for a more minimalistic design.

//Backup
/*
  var map;

*/

// Initializing neccessary variables

var fokusHendelse = 0,		        //Will keep track on what article is in focus.
    $headerHeight = 0,		        //Will gets the header-height.
    $ingressHeight = 0,	          //Will get the height of the excerpt-text later.
    $boolIngress = true,          //If true the excerpt-text is visible.
    boolFullscreenSlider = false,	//If true a slider is in fullscreen-mode.
    mapInTimeline = false, 			  //If true there is a map present in the timeline.
    maparray = [],                //Array for all the possible maps
    markerarray = [],             //Array for all the markers on the maps
    swipes = [],                  //Array with all the media-sliders.
    mobileStickyHeaderFinished = false;     //If true a sticky header for mobile is cloned and ready.   
    responsiveStickyHeaderClosed = false;       

var kategori1,
    kategori2,
    kategori3,
    kategori4,
    kategori5,
    kategori6;

var catColor1,
    catColor2,
    catColor3,
    catColor4,
    catColor5,
    catColor6;

//Array with Norwegian monthnames
var norwegian_month = new Array();
	norwegian_month[0] = "januar";
	norwegian_month[1] = "februar";
	norwegian_month[2] = "mars";
	norwegian_month[3] = "april";
	norwegian_month[4] = "mai";
	norwegian_month[5] = "juni";
	norwegian_month[6] = "juli";
	norwegian_month[7] = "august";
	norwegian_month[8] = "september";
	norwegian_month[9] = "oktober";
	norwegian_month[10]= "november";
	norwegian_month[11]= "desember";

//Array with Norwegian shortened monthnames
var norwegian_month_short = new Array();
    norwegian_month_short[0] = "jan";
    norwegian_month_short[1] = "feb";
    norwegian_month_short[2] = "mar";
    norwegian_month_short[3] = "apr";
    norwegian_month_short[4] = "mai";
    norwegian_month_short[5] = "jun";
    norwegian_month_short[6] = "jul";
    norwegian_month_short[7] = "aug";
    norwegian_month_short[8] = "sep";
    norwegian_month_short[9] = "okt";
    norwegian_month_short[10]= "nov";
    norwegian_month_short[11]= "des";

/*
var $tlWrapper = $(".nu-timeline-wrapper"),
$tlHeader = $("#nu-timeline-header"),
$tlHeaderWrapper = $('.nu-timeline-header-wrapper'),
$tlHeaderIngress = $('#nu-timeline-ingress'),
$tlHendelse = $('.nu-timeline-hendelse'),
$indikator = $('.nu-timeline-indikator');*/

$window = $(window);


function getTimeline(timeline_id){

    $(document).ready(function(){

      	getTimelineData(timeline_id);    //Gets data with AJAX and appends the DOM.  	 

      	initButtons();      	
      	initMaps();
        initSliders();

        scrollListener();
        hoverListener();
        keyboardListener();

        responsiveSliders();         
       
        fixCategoryColors();
        //makeBottomSpace();      //May be useful if there is nothing under timeline, so you can scroll properly to the last event 
        checkNav();
   
      	              
    });

    $(window).load(function(){

        resizeListener();   
        fixHeaderSize();

        $headerHeight = $tlHeader.height() + $('#smallHeader').height() - $ingressHeight;

        $('.nu-timeline-hendelse:not(.nu-timeline-hendelse-inactive)').waypoint(function(direction) {

             //$tlHendelse = $('.nu-timeline-hendelse:not(.nu-timeline-hendelse-inactive)');
             fokusHendelse = $('.nu-timeline-hendelse').index(this);     

              if(direction == 'up'){

                    if (fokusHendelse <= 0){
                                        
                       return false;
                    }

                    fokusHendelse--;             
                    
              }  

              console.log('første waypoint, fokus: ' + fokusHendelse);
              $('.nu-timeline-indikator:not(.nu-timeline-indikator-inactive)').eq(fokusHendelse).addClass("nu-timeline-indikator-selected").siblings().removeClass("nu-timeline-indikator-selected"); //Sets active class on the active indicator
              
              $('.nu-timeline-indikator').children("div.nu-timeline-indikator-open").not('.nu-timeline-indikator-first, .nu-timeline-indikator-last').hide(); //Hides all the hover-dates 

              var prosent = $('.nu-timeline-indikator:not(.nu-timeline-indikator-inactive)').eq(fokusHendelse).attr('data-date-percent'); //Finds the percent to the left of the indicator

             if( $(window).width() < responsiveWidth){ //If mobile
                 
                  $('#responsiveStickyHeader .mobileProgressBar').width("" + prosent + "%");
                  var currentDate = $('.nu-timeline-indikator:not(.nu-timeline-indikator-inactive)').eq(fokusHendelse).children("div.nu-timeline-indikator-open").html();
                  $('#responsiveStickyHeader .mobileProgressDate').html(currentDate);
                  $('#responsiveStickyHeader .mobileProgressDate').show();
                  
                  if (prosent <= 10){
              
                      $('#responsiveStickyHeader .mobileFirstDate').hide();
                      $('#responsiveStickyHeader .mobileLastDate').show();
                      var progressDateWidth = $('#responsiveStickyHeader .mobileProgressDate p').width();
                      $('#responsiveStickyHeader .mobileProgressDate').css({'margin-right':''+(-105)+'px','text-align':'left'});

                  }else if (prosent >= 90){  
        
                      $('#responsiveStickyHeader .mobileLastDate').hide();
                      $('#responsiveStickyHeader .mobileFirstDate').show();                      //  $('#mobileProgressDate').css({"text-align":"right"});
                      $('#responsiveStickyHeader .mobileProgressDate').css({'right':'5px','text-align':'right'});

                  }else if (prosent > 10 && prosent < 90){
    
                       $('#responsiveStickyHeader .mobileFirstDate, #responsiveStickyHeader .mobileLastDate').show();
                       $('#responsiveStickyHeader .mobileProgressDate').css({'right':'-100px','text-align':'center',"margin":"0"});
                  }  

              } else { //If desktop
             

                  if (prosent <= 10){                  
                      
                      $('.nu-timeline-indikator-first').hide();
                      $('.nu-timeline-indikator-last').show();
                      

                  }else if (prosent >= 90){            
                      $('.nu-timeline-indikator-last').hide();
                      $('.nu-timeline-indikator-first').show();
                       
                  }else if(prosent > 10 && prosent < 90){
                      $('.nu-timeline-indikator-last, .nu-timeline-indikator-first').show();
                      
                      //  $('#mobileProgressDate').css({"text-align":"center"});
                  }

                $('.nu-timeline-indikator:not(.nu-timeline-indikator-inactive)').eq(fokusHendelse).children("div.nu-timeline-indikator-open").show();
                    //alert($('.nu-timeline-indikator:not(.nu-timeline-indikator-inactive)').eq(fokusHendelse).children("div.nu-timeline-indikator-open").html());
                   }
                 
              checkNav();
     

             },{
                offset: function(){
                                      if ($(window).width() > responsiveWidth){    //IF desktop                                 
                                       
                                        return  $headerHeight; //Circus-height of the header without ingress(excerpt). 
                                      
                                      }else{
                                        return 75; 
                                      }
                                    },
                horizontal: false,
                continuous: false

                

          });


        //Initializes Isotope.

        var $container = $('.nu-timeline-hendelse-wrapper');

        $('.nu-timeline-hendelse-wrapper').isotope({

              layoutMode: 'straightDown'
            
        }, function(){

             
        });         

        $(document).on("click",'.btnCategories', function(){
        
            $('.nu-timeline-category-wrapper ul li ul').fadeToggle(100);   
            $('.catChooser-arrow').toggleClass('catChooser-droppedDown'); 
  
        });


        $(document).on("click",'.nu-timeline-category-wrapper ul li ul li',function(){
         
           var selector = $(this).attr('data-category');
           var filters = [];

           $('.nu-timeline-category-wrapper ul li ul li[data-category="' + selector + '"]').toggleClass('cbCategoryUnchecked');
           $('.nu-timeline-hendelse[data-category="' + selector + '"]').toggleClass("nu-timeline-hendelse-inactive");
           $('.nu-timeline-indikator[data-category="' + selector + '"]').toggleClass("nu-timeline-indikator-inactive");
            // get checked checkboxes values
           
            $(".nu-timeline-indikator").children('div').removeClass('nu-timeline-indikator-first');
            $(".nu-timeline-indikator").children('div').removeClass('nu-timeline-indikator-last');
            $(".nu-timeline-indikator").children('div').removeAttr('style');

            var newSortDates = [];
            var newSortCategories = [];
            var newSortCustomTime = [];
            var newSortImportantDates = [];
            //SØKHER
         

           
           $('.nu-timeline-indikator:not(.nu-timeline-indikator-inactive)').each(function(){


              var thisDate = $(this).attr("data-date");     
              var withoutClock = thisDate.split(" ");
              var date_splitted = withoutClock[0].split("-");        
                            
              var year = date_splitted[2];
              var month = parseInt(date_splitted[1]) + 1;
              var monthday = date_splitted[0];
              var hours = withoutClock[1];         
              var mins = withoutClock[2];

              var hendelseDato = new Date(year + "/" + month + "/" + monthday + " " + hours + ":" + mins); //Makes a Dateobject, with clocktime. Should be suitable for both mobiles, webkit and ie8.         

              newSortDates.push(hendelseDato);
              newSortCategories.push($(this).attr("data-category"));
              newSortCustomTime.push("Dummy");
              newSortImportantDates.push("Dummy");

           });

            var thisTime = new Date(0,0,0); //This date has to be earlier than the first content_date of timeline
            var prevTime = new Date();      //Todays date 

            for (var i = 0; i < newSortDates.length; i++){
              
                //Finds the earliest date of this timeline
                if(newSortDates[i].getTime() < prevTime.getTime()){
                    prevTime = newSortDates[i];
                }

                //Finds the last date of this timeline
                if(newSortDates[i].getTime() > thisTime.getTime()){
                    thisTime = newSortDates[i];
                }

            }
     
            //Calculating the difference between first and last date in days.
            var dager = (thisTime.getTime() - prevTime.getTime()) / (1000*60*60*24);
            
            for (var i = 0; i < newSortDates.length; i++){
                 
                //Finds milliseconsd from this date(i), to the first date of the timeline. 
                var tidsaspekt_milli = newSortDates[i].getTime() - prevTime.getTime();
                
                //Converts milliseconds to days
                var tidsaspekt_dager = (tidsaspekt_milli / (1000*60*60*24));
                
                //Finds the percent of this date compared to the entire timeaspect.
                var prosent = ((tidsaspekt_dager / dager) * 100).toFixed(2);

                var datoFormatert = newSortDates[i].getDate().toString() + "-" + newSortDates[i].getMonth().toString() + "-" + newSortDates[i].getFullYear().toString() + " " + newSortDates[i].getHours().toString() + " " + newSortDates[i].getMinutes().toString();
               
                $('.nu-timeline-indikator[data-date="' + datoFormatert + '"]').attr('data-date-percent', prosent)
                                                                              .css({left: prosent + "%"})
                                                                              .children('.nu-timeline-indikator-open').attr('data-date-percent', prosent);

             
                $(".nu-timeline-indikator[data-date-percent='" + prosent + "']").css({left: prosent + "%" });

                    //The first and last date will be shown by default.
             /*   if (i == 0){
                   // $(".nu-timeline-indikator-open[data-date-percent='" + prosent + "']").show();

                    $(".nu-timeline-indikator-open[data-date-percent='" + prosent + "']").addClass('nu-timeline-indikator-first');
                    //$('.mobileFirstDate').html(dateToolTip);
                }
                if (i == newSortDates.length - 1){
                  //  $(".nu-timeline-indikator-open[data-date-percent='" + prosent + "']").show();
                    $(".nu-timeline-indikator-open[data-date-percent='" + prosent + "']").addClass('nu-timeline-indikator-last');
                   // $('.mobileLastDate').html(dateToolTip);

                }*/

                // If the indicator is at the edge of wrapper, we need to position the viewable date so it doesnt overflow the edge of wrapper.

                 if(prosent < 5){           
                       $(".nu-timeline-indikator-open[data-date-percent='" + prosent + "']").css({"text-align":"left","margin-left":"0","background-position":"5px 16px" });
                  }else if(prosent > 95){
                       $(".nu-timeline-indikator-open[data-date-percent='" + prosent + "']").css({"text-align":"right","margin-left":"0","right":"0","background-position":"93px 16px" });
                  }

              }

              $(".nu-timeline-indikator:not(.nu-timeline-indikator-inactive):last").children('div').addClass('nu-timeline-indikator-last').show();
              $(".nu-timeline-indikator:not(.nu-timeline-indikator-inactive):first").children('div').addClass('nu-timeline-indikator-first').show();
          // printIndicators(newSortDates, newSortImportantDates, newSortCustomTime, newSortCategories);
           //fixCategoryColors();

           $('.nu-timeline-hendelse:not(.nu-timeline-hendelse-inactive)').each(function(){

                if($(this).attr('data-category')){
                    filters.push( ".nu-timeline-hendelse[data-category='" + $(this).attr('data-category') + "']" );
                }else{

                }
                  
            });


            filters = filters.join(', ');
           
            $container.isotope({ filter: filters },function(){ 
                  
             
 $.waypoints('destroy');
           
           setTimeout(function(){ 
            
             
            $('.nu-timeline-hendelse:not(.nu-timeline-hendelse-inactive)').waypoint(function(direction) {

             //$tlHendelse = $('.nu-timeline-hendelse:not(.nu-timeline-hendelse-inactive)');
             fokusHendelse = $('.nu-timeline-hendelse:not(.nu-timeline-hendelse-inactive)').index(this);     

            if(direction == 'up'){

                if (fokusHendelse <= 0){    
                    
                    return false;

                }

                fokusHendelse--;
               
            }else if(direction == 'down'){

                if ($boolIngress){
                   
                }               
            }
            console.log("andre, fokus: " + fokusHendelse);
              
                $('.nu-timeline-indikator:not(.nu-timeline-indikator-inactive)').eq(fokusHendelse).addClass("nu-timeline-indikator-selected").siblings().removeClass("nu-timeline-indikator-selected"); //Sets active class on the active indicator
                $('.nu-timeline-indikator').children("div.nu-timeline-indikator-open").not('.nu-timeline-indikator-first, .nu-timeline-indikator-last').hide(); //Hides all the hover-dates 
                
                var prosent = $('.nu-timeline-indikator:not(.nu-timeline-indikator-inactive)').eq(fokusHendelse).attr('data-date-percent'); //Finds the percent to the left of the indicator

                if( $(window).width() < responsiveWidth){ //If mobile
                 
                  $('#responsiveStickyHeader .mobileProgressBar').width("" + prosent + "%");
                  var currentDate = $('.nu-timeline-indikator:not(.nu-timeline-indikator-inactive)').eq(fokusHendelse).children("div.nu-timeline-indikator-open").html();
                  $('#responsiveStickyHeader .mobileProgressDate').html(currentDate);
                  $('#responsiveStickyHeader .mobileProgressDate').show();
                  
                  if (prosent <= 10){
              
                      $('#responsiveStickyHeader .mobileFirstDate').hide();
                      $('#responsiveStickyHeader .mobileLastDate').show();
                      var progressDateWidth = $('#responsiveStickyHeader .mobileProgressDate p').width();
                      $('#responsiveStickyHeader .mobileProgressDate').css({'margin-right':''+(-105)+'px','text-align':'left'});

                  }else if (prosent >= 90){  
        
                      $('#responsiveStickyHeader .mobileLastDate').hide();
                      $('#responsiveStickyHeader .mobileFirstDate').show();                      //  $('#mobileProgressDate').css({"text-align":"right"});
                      $('#responsiveStickyHeader .mobileProgressDate').css({'right':'5px','text-align':'right'});

                  }else if (prosent > 10 && prosent < 90){
    
                       $('#responsiveStickyHeader .mobileFirstDate, #responsiveStickyHeader .mobileLastDate').show();
                       $('#responsiveStickyHeader .mobileProgressDate').css({'right':'-100px','text-align':'center',"margin":"0"});
                  }  

              } else { //If desktop
                  
                   $('.nu-timeline-indikator-last, .nu-timeline-indikator-first').show();

                  if (prosent <= 10){                  
                      
                      $('.nu-timeline-indikator-first').hide();
                      $('.nu-timeline-indikator-last').show();
                      
                  }else if (prosent >= 90){            

                      $('.nu-timeline-indikator-last').hide();
                      $('.nu-timeline-indikator-first').show();
                       
                  }else if(prosent > 10 && prosent < 90){

                      $('.nu-timeline-indikator-last, .nu-timeline-indikator-first').fadeIn();
                      
                      //  $('#mobileProgressDate').css({"text-align":"center"});
                  }

                $('.nu-timeline-indikator:not(.nu-timeline-indikator-inactive)').eq(fokusHendelse).children("div.nu-timeline-indikator-open").show();
                    //alert($('.nu-timeline-indikator:not(.nu-timeline-indikator-inactive)').eq(fokusHendelse).children("div.nu-timeline-indikator-open").html());
                   }
                 
              checkNav();

            },{
                offset: function(){
                                      if ($(window).width() > responsiveWidth){                                    
                                      
                                        return  $headerHeight; //Circus-height of the header without ingress(excerpt). 
                                      
                                      }else{
                                        return 75; 
                                      }
                                    },
                horizontal: false,
                continuous: false

            });//End waypoints

          },800);
             
         });//End isotope-filtering

       });//End category click


        


    });//End window.load

  

}//End getTimeline()

function getTimelineData(timeline_id){
  
  $('.nu-timeline-hendelse-wrapper').html("<img id='nu-timeline-loading' src='gfx/loading2.gif' alt='Laster tidslinje...' />"); //Sets a loading gif until timeline is appended
  
  var htmlHeaderTxt = "";   //String for header.
  var htmlTxt = "";         //This string will contain all the html to be rendered.
  var datoArray = [];       //This array will contain all the dates of the timeline.
  var importantDates = [];  //Stacks the important dates, so they can stand out.
  var customDates = [];     //Will be used to contain the dates that are custom-written from cms.
  var categories = [];      //Will be used to help out the indicators color-setting depending on category.
  
  var mapCounter = 0;       //This int will count the number of maps to be shown in the timeline.
  var sliderCounter = 0;    //This int will count all the picture-sliders in the timeline.
  
  var url = 'http://www.zupe.org/CMSv2/fetchToJson.php?id=' + timeline_id + ''; //The url to json
  var url = 'http://10.200.100.107/Aftenposten/code/CMS/CMSv2/fetchToJson.php?id=' + timeline_id + ''; 
  $.support.cors = true;  //IE8 depends on it.

  $.ajaxSetup({           //Custom settings for AJAX
      async: false,
      cache:true
  });

  $.getJSON(url, function(jsonData){

      $.each(jsonData.timeline, function(i,item){

              var timeline_title = item.tl_name;       //Title of timeline
              var timeline_ingress = item.tl_ingress;  //Excerpt
              var timeline_date = item.tl_date;        //Date created
              var timeline_changed = item.tl_lastEdit; //Last changed

              htmlHeaderTxt += "<div id='responsiveStickyHeader'></div>"; //A sticky header-div the mobile version 
              htmlHeaderTxt += "<div class='nu-timeline-header-wrapper' data-tap-toggle='false'>";
              htmlHeaderTxt += "<div id='nu-timeline-header'>";
              htmlHeaderTxt += wrapTxt(timeline_title,"h1");
              htmlHeaderTxt += "<p id='nu-timeline-ingress'>" + timeline_ingress + "</p>";            
              htmlHeaderTxt += "<div class='nu-timeline-category-wrapper'><ul class='nu-timeline-category-list'>";
              htmlHeaderTxt += "<li id='catChooser'><a class='btn btn-inverse btnCategories'>Kategorier<span class='catChooser-arrow'></span></a><ul><div id='nu-timeline-arrow-up'></div>";        

              //Loops through the categories, adds them to our DOMstring and also gives them the color selected from CMS.
              $.each(item.categories, function(x,cat_item){

                  if(cat_item.category1){             
                     htmlHeaderTxt += '<li data-category="' + cat_item.category1 + '" class="cbCategory" style="background-color:'+ cat_item.color1 +'"><span>' + cat_item.category1 + '</span></li>';
                  }
                  if(cat_item.category2){
                     htmlHeaderTxt += '<li data-category="' + cat_item.category2 + '" class="cbCategory" style="background-color:'+ cat_item.color2 +'"><span>' + cat_item.category2 + '</span></li>';
                  }
                  if(cat_item.category3){
                      htmlHeaderTxt += '<li data-category="' + cat_item.category3 + '" class="cbCategory" style="background-color:'+ cat_item.color3 +'"><span>' + cat_item.category3 + '</span></li>';
                  }
                  if(cat_item.category4){
                     htmlHeaderTxt += '<li data-category="' + cat_item.category4 + '" class="cbCategory " style="background-color:'+ cat_item.color4 +'"><span>' + cat_item.category4 + '</span></li>';
                  }
                  if(cat_item.category5){
                     htmlHeaderTxt += '<li data-category="' + cat_item.category5 + '" class="cbCategory" style="background-color:'+ cat_item.color5 +'"><span>' + cat_item.category5 + '</span></li>';
                  }
                  if(cat_item.category6){
                     htmlHeaderTxt += '<li data-category="' + cat_item.category6 + '" class="cbCategory" style="background-color:'+ cat_item.color6 +'"><span>' + cat_item.category6 + '</span></li>';
                  }

              });

              htmlHeaderTxt += "</ul></li></ul></div>";
              htmlHeaderTxt += '<div id="nu-timeline-navi"><a class="nu-timeline-prev btn  btn-primary">« Forrige</a><a class="nu-timeline-next btn  btn-primary">Neste »</a></div>';
              htmlHeaderTxt += '<div id="nu-timeline-indikator-wrapper"><div id="nu-timeline-indikator-wrapper2">';
              htmlHeaderTxt += '<p class="mobileFirstDate"></p><p class="mobileLastDate"></p><div class="mobileProgressBar"><div class="mobileProgressDate"></div></div>';
              htmlHeaderTxt += '<div class="indicatorSuperWrap"><div class="nu-timeline-indikator-line"></div></div>'
              htmlHeaderTxt += '</div></div></div></div><div class="nu-timeline-clearFix"></div>';
             
              $('.nu-timeline-wrapper').html(htmlHeaderTxt); //Prints out the header-dom-string to the timelinewrapper.

              $.each(item.content, function(i, item){//Second indent

                  var content_id =   item.content_ID;         //Article-/Content-id
                  var title =        item.content_title;      //Title of article
                  var time =         item.content_time;       //Clock time of article
                  var date =         item.content_date;       //Date time of article
                  var custom_time =  item.content_custom;     //Custom time of article
                  var important =    item.content_important;  //Extra important article, true or false.          
                  var content =      item.content_content;    //The text-content of the article.
                  var category =     item.content_category;   //The category of the article
                  var publishedBool =item.content_status;     //Is this article live? True or false.
                  var mediaboolean = item.content_media;      //Does this item contain any media? True of false.
                  var mediacontent = item.media;              //Array with all the media of this article.

                  var mediaString = "";             //This string will be built up with ALL the html for the timeline's MEDIA.

                  if(publishedBool == "1"){         //If publishedBool is 1 then this article should be printed.          
                  
                    if (mediaboolean == "1"){       //If there is media in this article, then we need some extra functionality for this article.

                          var movieString = "";     //HTML-string for movieclip     
                          var pictureString = "";   //HTML-string for pictures
                          var mapString = "";       //HTML-string for map
                          var firstPic = true;      //Since there can be multiple pics in a slider we need this to be true later.
                          var boolPicture = false;  // We dont't know what kind of media-type is to come. So we expect there to be none so far. 
                          var boolVideo = false;    // We dont't know what kind of media-type is to come. So we expect there to be none so far. 
                          var boolMap = false;      // We dont't know what kind of media-type is to come. So we expect there to be none so far. 

                          mediaString = "<div class='nu-timeline-hendelse-media'>"; //Adds a mediawrapper

                          var tabString = "<ul class='nav nav-tabs'>";              //Since we have the different types of media in tabs, this will wrap the different navigation-tabs with ul.
                          var tabContentWrapper = "<div class='tab-content'>";      //This string will wrap the media-content in the difference tabs.                       
                          
                          $.each(mediacontent, function( y, mediaitem ){

                              if (mediaitem.media_type == "picture") {

                                  boolPicture = true;   //Now we know there is a picture.
                                  
                                  if (firstPic) { 

                                      pictureString += "<div class='tab-pane' id='BildeTab-" + content_id + "'>";   //Creates the content-div/pane of picture-tab
                                      pictureString += "<div class='smallSlider'><div id='swipeSlider"+ sliderCounter +"' class='swipe'><div class='swipe-wrap'>"; //Creates divs for sliderwrapper and slider. Gives the slider an ID so we can hook later.
                                      pictureString += "<div class='swipeSlideContent'><div class='nu-timeline-slider-image' style='background-image:url("+mediaitem.media_data+")'><div class='nu-timeline-slider-tekst'><p>"+ mediaitem.media_text + "</p></div></div></div>";//Puts the picture to the list, and a wrapper that wraps the picture and text.
                                      firstPic = false; //The first picture has now past.              
                                 
                                  } else {    

                                      pictureString += "<div class='swipeSlideContent'><div class='nu-timeline-slider-image' style='background-image:url("+mediaitem.media_data+")'><div class='nu-timeline-slider-tekst'><p>"+ mediaitem.media_text + "</p></div></div></div>";
                                  
                                  }
                              }//End if "picture"

                              else if (mediaitem.media_type == "map") {

                                  boolMap = true;       //We now know there is a map
                                  mapInTimeline = true;   //The map needs to render after DOM is ready, so this will happen if true later.
                                  var data_splitted = mediaitem.media_data.split(",");  //Splits the mediaitemdata, the prefix is 3 values separeted with "," in this order: long,lat,zoom-level. 
                                  mapString += "<div class='tab-pane ' id='KartTab-" + content_id + "'>";
                                  mapString += "<div class='nu-timeline-map' data-map-number='"+content_id+"' data-map-longitude='"+data_splitted[0]+"' data-map-latitude='"+data_splitted[1]+"' data-map-zoom='"+data_splitted[2]+"'></div>";
                              
                              }//End if "map"

                              else if (mediaitem.media_type == "video") {

                                  boolVideo = true; //We now know there is a video.
                                  movieString = "<div class='tab-pane' id='FilmTab-" + content_id + "'><div id='embedPlayerHere'></div><script type='text/javascript' src='http://aftenposten.no/embed?id=" + mediaitem.media_data + "&width=448&height=300'></script></div>"; 
                            
                              }//End if "video"

                          }); //END each(mediacontent)
                          
                          if (boolMap) {     //If there is a map, create the map-tab                               
                             
                              tabString += "<li class='pushTabsRight'><a id='mapTab' href='#KartTab-" + content_id + "' tab-for-map='"+mapCounter+"'>Kart</a></li>";
                              mapString += "</div>"
                           
                              mapCounter++;   
                          }
                         
                          if (boolPicture) {  //If there is pictures, create the picture-tab
                              tabString += "<li class='pushTabsRight'><a id='pictureTab' href='#BildeTab-"+ content_id +"' tab-for-slider='"+ sliderCounter +"'>Bilder</a></li>";
                              pictureString += "</div>";
                              pictureString += "<a class='nu-timeline-slider-control left' onclick='swipes["+sliderCounter+"].prev()' data-slide='prev'></a><a class='nu-timeline-slider-control right' onclick='swipes["+sliderCounter+"].next()' data-slide='next'></a>";
                              pictureString += "<div class='nu-timeline-slider-fullscreen-btn' slider-to-expand="+sliderCounter+"></div>";
                              pictureString += "</div></div></div>";
                              
                              sliderCounter++;
                           
                          }

                          if (boolVideo) {    //If there is a video, create the videotab.
                              tabString += "<li class='pushTabsRight'><a href='#FilmTab-" + content_id + "'>Videosnutt</a></li>";
                           
                          }
                        
                          tabContentWrapper += mapString;       //Appends the tab-content with map
                          tabContentWrapper += pictureString;   //Appends the tab-content with picture
                          tabContentWrapper += movieString;     //Appends the tab-content with movie 
                          tabContentWrapper += "</div>";        //Closes the tab-content div.

                          mediaString += tabString + "</ul>";       //Appends the html-tabs to mediaString.
                          mediaString += tabContentWrapper + "</div>";  //Appends the tab-content to the main mediaString and closes the whole mediaWrapper.  
                                       
                    }//END if(MEDIA=TRUE)

                  //Dates will be handled in the below code.         

                  //Have to change the date-format from "mm-dd-yyyy" to "mm/dd/yyyy" for IE8 to accept the date-object.
                  var date_splitted = date.split("-");
                  var new_date_format = "";    
                  var new_date_test = date_splitted[0] + "," + date_splitted[1] + "," + (date_splitted[2]);
               
                  //SØK
                  for (var i = 0; i < date_splitted.length; i++) {
                    if(i == date_splitted.length-1){                  
                      new_date_format += date_splitted[i];
                      break;
                    }   
                    new_date_format += date_splitted[i] + "/";
                  }
                  var klokkeslett;
                  if (time){
                    klokkeslett = time;
                  }else{
                    klokkeslett = "";
                  }
                  var hendelseDato = new Date(new_date_format + " " + klokkeslett); //Makes a Dateobject, with clocktime. Should be suitable for both mobiles, webkit and ie8.                
                 
                  datoArray.push(hendelseDato);   //Pushes each date to an array which we loop through later to make indicators.
                  importantDates.push(important); //Pushes variable important, must have the same index as the pushed date above.
                  customDates.push(custom_time);  //Pushes dates that don't fit with Date() to array
                  categories.push(category);      //Pushes categories so we can match them with the dates
                 
                  //Makes a formatted date-string that will be used as attributte named "data-date"
                  //Indicators will get the same attribute "data-date" later in function printIndicators().
                  //This attribute will be used to compare the clicked indicator with an article, so we can scroll to the right event in the timeline.
                  var datoFormatert = hendelseDato.getDate().toString() 
                                    + "-" + hendelseDato.getMonth().toString() 
                                    + "-" + hendelseDato.getFullYear().toString()
                                    + " " + hendelseDato.getHours() + " " + hendelseDato.getMinutes();
                  //console.log("Date: " + date + " hendelsesDato: " + hendelseDato + " datoFormatert: " + datoFormatert );

                  var date_time = hendelseDato.getHours().toString() + ":" + (hendelseDato.getMinutes()<10?'0':'') + hendelseDato.getMinutes(); //Puts a 0 in front of minute if under 2 chars(10)..(Wont work on iphone?)
                  var date_month = hendelseDato.getDate().toString() + ". " + norwegian_month[hendelseDato.getMonth()];
                  var date_year = hendelseDato.getFullYear().toString();
                  var htmlTime = "";
                 
                  if ( custom_time == 0 || custom_time == null || custom_time == "" ){
                      if (time){
                         htmlTime +=  "<p class='nu-timeline-hendelse-time'>" + date_time + "</p>";
                      }
                     
                      htmlTime +=  "<p class='nu-timeline-hendelse-date'>" + date_month + "</p>";
                      htmlTime +=  "<p class='nu-timeline-hendelse-year'>" + date_year + "</p>";
                  }else{
                      htmlTime += "<p class='nu-timeline-hendelse-customtime'>" + custom_time + "</p>";
                  }

                  if ( category == 0 || category == null || category == "" ) {
                      category = "noCategory"; //Put a category on articles that doesnt have one, so we can style properly later.
                  }

                  var importantClass;
                  if ( important == "Ja" ){
                    importantClass = "nu-timeline-hendelse-important";
                  }else{
                    importantClass = "";
                  }

                  htmlTxt += "<div class='nu-timeline-hendelse " + category + " " + importantClass + "' data-date='" + datoFormatert + "' data-category='"+ category +"'>";
                  htmlTxt +=    "<div class='nu-timeline-hendelse-left-wrapper'>"
                  htmlTxt +=        "<div class='nu-timeline-hendelse-tid'>";
                  htmlTxt +=            htmlTime;   
                  htmlTxt +=        "</div>";                
                  htmlTxt +=    "</div>";
                  htmlTxt +=    "<div class='nu-timeline-hendelse-innhold'>";
                  htmlTxt +=        "<p class='nu-timeline-hendelse-category' data-category='" + category + "'>"+category+"</p>";
                  htmlTxt +=         wrapTxt(title,"h2");
                  htmlTxt +=         mediaString; 
                  htmlTxt +=        "<div class='nu-timeline-hendelse-story'>";
                  htmlTxt +=            wrapTxt(content, "p");
                  htmlTxt +=        "</div>";
                  htmlTxt +=    "</div>"
                  htmlTxt +=  "</div>";
          
          }//End if(published)                 
            
        });//End each(content/article)
           
        $('.nu-timeline-wrapper').append("<div id='fullscreenSlider'></div><div class='nu-timeline-hendelse-wrapper'>" + htmlTxt + "</div><div class='nu-timeline-bottom-pusher'></div>"); //Skriver ut strengen htmlTxt.
        $('.nu-timeline-hendelse[data-category="noCategory"] .nu-timeline-hendelse-category').hide(); //Hides the categorytext for the articles that actuelly is without category..

        //The necessary arrays to print out indicators is ready, now we run the function with arrays as parameters.
        printIndicators(datoArray, importantDates, customDates, categories); 
        
        //Now that elements are printed out we bind them to variables.. Prevents multiple calls to the same element.
        $tlWrapper = $(".nu-timeline-wrapper");
        $tlHeader = $("#nu-timeline-header");
        $tlHeaderWrapper = $('.nu-timeline-header-wrapper');
        $tlHeaderIngress = $('#nu-timeline-ingress');
        $tlHendelse = $('.nu-timeline-hendelse');
        $indikator = $('.nu-timeline-indikator');
        $tlBottom = $('.nu-timeline-bottom-pusher');


        //Sets the most left tab active and the content that belongs(within media div of each timeline-item)
        $('.tab-content div.tab-pane:last-child, .nav-tabs li:last-child').addClass('active');  

        

      });//End each(timeline)

  }); //End $.getJSON

}//END func(getTimelineData)

function responsiveSliders(){
   if ($(window).width() < responsiveWidth){ //if mobile

        $('.nu-timeline-hendelse-media').width($(window).width()).height("auto");
        // $('.tab-pane').height("auto");
        /*$('.smallSlider .swipe').height($(window).height() / 2);
        $('.smallSlider .swipe-wrap').height($(window).height()).width($(window).width());
        $('.smallSlider .swipeSlideContent').height($(window).height() / 2);
        $('.smallSlider .swipeSlideContent .nu-timeline-slider-image').css("height",$(window).height());
        $('.smallSlider .swipeSlideContent .nu-timeline-slider-image').css("width",$(window).width());*/
        // $('.swipe').height('auto');
                  
    } else {  //If desktop
        $('.nu-timeline-hendelse-media').width(470);
       /* $('.nu-timeline-hendelse-media').width(470);
        $('.tab-pane').height(300);
        $('.smallSlider .swipe').height(300);   
        $('.smallSlider .swipe-wrap').height("auto");     
        $('.smallSlider .swipeSlideContent').height("300px");
        $('.smallSlider .swipeSlideContent img').css("max-height","300px");        
        $('.smallSlider .swipeSlideContent img').css("max-width","448px");   */ 
     
    }

}//END-func(responsiveSliders)

function fixCategoryColors(){

    var windowWidth = $(window).width();

    if($(window).width() < responsiveWidth){ //If mobile
          $('.nu-timeline-category-wrapper ul li ul').addClass('nu-timeline-category-vertical');
          $('.nu-timeline-category-wrapper, .nu-timeline-category-list').addClass("zeroMargin");
          $('#catChooser a').fadeIn();
             

          $('.cbCategory').each(function(){

              var whatCategory = $(this).attr('data-category');
              var whatColor = $(this).css("background-color");
              
              $('.nu-timeline-hendelse-category[data-category="'+ whatCategory +'"]').css("color", ""+whatColor+"");
          
          });

    }else{

        $('.cbCategory').each(function(){

            var whatCategory = $(this).attr('data-category');
            var whatColor = $(this).css("background-color");

            $('.nu-timeline-hendelse[data-category="'+ whatCategory +'"]').css("border-color", ""+whatColor+"");
            $('.nu-timeline-indikator[data-category="'+ whatCategory +'"]').css("background-color", ""+whatColor+"");
            $('.nu-timeline-hendelse-category[data-category="'+ whatCategory +'"]').css("color", ""+whatColor+"");

        });

    }  
    
}//End func(fixCategoryColors)

function fixHeaderSize(){
    $headerHeight = $tlHeader.height();
    $ingressHeight =  $tlHeaderIngress.height();

    $tlHeaderWrapper.height($headerHeight + $('#smallHeader').height()); 
   
    console.log("Fixheadersize: " + $headerHeight + $('#smallHeader').height());
    //Foreløpig løsning for reponsivt design: Fixed-div 100%.
   /* var $headerWidth = $tlWrapper.width();
    $tlHeaderWrapper.width($headerWidth);
   */

}//END-func(fixHeaderSize)

function initMaps(){

	if (mapInTimeline){	

		//Function for IE8, gets all nodes with specific classname within node. 
		//Copied from: http://stackoverflow.com/questions/7410949/javascript-document-getelementsbyclassname-compatibility-with-ie	
		function getElementsByClassName(node, classname) {
		    var a = [];
		    var re = new RegExp('(^| )'+classname+'( |$)');
		    var els = node.getElementsByTagName("*");
		    for(var i=0,j=els.length; i<j; i++)
		        if(re.test(els[i].className))a.push(els[i]);
		    return a;
		}

		maps = getElementsByClassName(document.body,'nu-timeline-map'); //Finding all classes with the specific classname, and puts 'em in array.
		
		for (var i = 0; i < maps.length; i++){
			
			var longitude = maps[i].getAttribute("data-map-longitude");
			var latitude = maps[i].getAttribute("data-map-latitude");
			var mapzoom = maps[i].getAttribute("data-map-zoom");
			var myLatlng = new google.maps.LatLng(longitude,latitude); //Possibly wrong order of latlng/lnglat

			maparray[i] = new google.maps.Map(maps[i], {		//Makes this map
			    zoom: parseInt(mapzoom),						//Zoom-level(author decides)
		      	center: myLatlng,								//Centers the map		
		     	mapTypeId: google.maps.MapTypeId.ROADMAP,		//Maybe make this custom from CMS
		     	scrollwheel: false								//Disabled scrollwheel for UX, avoiding the hoverscroll on map when document-scroll.
		    });

		    markerarray[i] = new google.maps.Marker({			//Adds a marker
		        position: myLatlng,
		        map: maparray[i]
		    });

		  
	    }//END-for

	}//END-if(map in timeline)

}//END-func(initMaps)
   
function initSliders(){  
  
  $('.swipe').each(function(i, obj) {
      //generates a new Swipe-object for each slider-div.

      swipes[i] = Swipe(obj, {
         callback: function(index, element) {

          if($(window).width > responsiveWidth){

            $('.nu-timeline-slider-tekst p').hide(); //hides picture-text while the slider animates.                          
          
          }
         },
         transitionEnd: function(index, element) {

           if($(window).width > responsiveWidth){

              $('.nu-timeline-slider-tekst p').fadeIn(200);  //shows the picture-text when the animation is done.

          }                      
         }             
      });

      //The code below adds a picture-counter before the picture-text.
      var numOfSlides = swipes[i].getNumSlides();
      var sliderItemCounter = 0;

      $(obj).children('div').children('.swipeSlideContent').each(function(i,sliderItem){
         sliderItemCounter++;
          $(sliderItem).children('.nu-timeline-slider-image').children('.nu-timeline-slider-tekst').children('p').prepend("" + sliderItemCounter + "/" + numOfSlides + ": ");
          
         

      });

      if(sliderItemCounter == 1){
        $(obj).children('.nu-timeline-slider-control').remove();
      }
             
  });//End each(swipe)
            
}//END func(initSliders)

function resizeListener() {

    $(window).resize(function (){
                    
        //makeBottomSpace();

        if ($(window).width() > responsiveWidth){ 
          $('#responsiveStickyHeader').hide();
     

       
        }else{     
      
          $('#fullscreenSlider .swipe-wrap .swipeSlideContent').each(function(){

              $(this).css("marginTop","" + ($(window).height() / 2) - ( $(this).height() / 2 )+ "px");

          });

            $tlHeader.css("position","relative");
            $('#nu-timeline-ingress').slideDown(300,'easeOutCubic');
            $tlHeader.removeClass("nu-timeline-header-shadow"); 

        } 

       
        
        responsiveSliders(); 
        fixCategoryColors();
        fixHeaderSize();
        //makeBottomSpace();

        setTimeout(function(){   //Animations may occur when resizing, lets wait for them to finish before we refresh the waypoints.
           
            $.waypoints('refresh');

            console.log("Refreshed");    
           

          }, 900);

    });

}//END func(resizeListener)

function hoverListener() {

        $indikator = $('.nu-timeline-indikator');
  
        //$indikator.not('.nu-timeline-indikator-selected').mouseover(function(){

          $(document).on('mouseover','.nu-timeline-indikator', function(){

            var active_pos = $(".nu-timeline-indikator-selected .nu-timeline-indikator-open").attr('data-date-percent');
            var this_pos = $(this).attr('data-date-percent');            
            var sum = this_pos - active_pos;
      
            if (sum >= -15 && sum <=15){
                $(".nu-timeline-indikator-selected .nu-timeline-indikator-open").hide();
            }
            if (this_pos < 15){
                $('.nu-timeline-indikator-first').hide();

            }else if(this_pos > 85){
                $('.nu-timeline-indikator-last').hide();
            }
      
            $(this).children("div.nu-timeline-indikator-open").show();

        });
        $(document).on('mouseout','.nu-timeline-indikator',function(){
              var active_pos = $(".nu-timeline-indikator-selected .nu-timeline-indikator-open").attr('data-date-percent');

            $(this).children("div.nu-timeline-indikator-open").not('.nu-timeline-indikator-first, .nu-timeline-indikator-last').hide();      
    
            if (active_pos < 15){
                $('.nu-timeline-indikator-first').hide();
                $('.nu-timeline-indikator-last').show();
                $('.nu-timeline-indikator-selected').children('.nu-timeline-indikator-open').show();

            }else if(active_pos > 85){
                $('.nu-timeline-indikator-last').hide();
                $('.nu-timeline-indikator-first').show();
                $('.nu-timeline-indikator-selected').children('.nu-timeline-indikator-open').show();

            }else {             
                $('.nu-timeline-indikator-first').show();
               $('.nu-timeline-indikator-last').show();
                $('.nu-timeline-indikator-selected').children('.nu-timeline-indikator-open').show();
            }

        });

}//END func(hoverListener)

function makeBottomSpace() { 

    var $windowHeight = $(window).height();

    var lastHendelse = $('.nu-timeline-hendelse:not(.nu-timeline-hendelse-inactive):last').height();
    $('.nu-timeline-bottom-pusher').height($windowHeight - lastHendelse + 305); 
   
}//END func(makeBottomSpace)

function makeMobileStickyheader() {
      if (!mobileStickyHeaderFinished){

        var cloned = $tlHeader.clone();                         //Clones the timeline-header
        $(cloned).find("#nu-timeline-ingress").remove().end();  //Removes the ingress-text       
        $(cloned).find(".nu-timeline-indikator").remove().end();  

        $('#responsiveStickyHeader').html(cloned);      //Append the timeline-header to the sticky-header for mobile, and shows it.
        $('#responsiveStickyHeader').prepend("<div class='responsiveStickyheaderClose'></div>");
        mobileStickyHeaderFinished = true;
     
      }
}//END func(makeMobileStickyHeader

function scrollListener() {
   
    $(window).scroll(function () {   
     
      if( responsiveWidth < $(window).width() ){ //If desktop

        var headerOffsetY = $tlHeaderWrapper.offset().top;
        var bottomOffsetY = $tlBottom.offset().top;
    
        if ($(this).scrollTop() > headerOffsetY && $(this).scrollTop() < bottomOffsetY) {            

            $tlHeader.css("position","fixed").fadeIn();
            $tlHeader.addClass("nu-timeline-header-shadow");  
            $('#nu-timeline-ingress').slideUp(300,'easeOutCubic');
            $boolIngress = false;
            $('#smallHeader').show(0);

            $('.nu-timeline-category-wrapper ul li ul').addClass('nu-timeline-category-vertical');
            $('.nu-timeline-category-wrapper, .nu-timeline-category-list').addClass("zeroMargin");
            $('#catChooser a').fadeIn();
            $('.nu-timeline-category-wrapper ul li ul').hide();           
            $('#nu-timeline-arrow-up').show();



         } else if($(this).scrollTop() > bottomOffsetY){
    
            $tlHeader.fadeOut();



         } else {

            $('#smallHeader').hide(0);
            $boolIngress = true;
            $tlHeader.css("position","relative");
            $('#nu-timeline-ingress').slideDown(300,'easeOutCubic', function(){
              fixHeaderSize();
            });
            $tlHeader.removeClass("nu-timeline-header-shadow"); 

            $('.nu-timeline-category-wrapper ul li ul').removeClass('nu-timeline-category-vertical');
            $('.nu-timeline-category-wrapper, .nu-timeline-category-list').removeClass("zeroMargin");
            $('.nu-timeline-category-wrapper ul li ul').show(); 
            $('#catChooser a').hide();
            $('#nu-timeline-arrow-up').hide();
            $('.nu-timeline-indikator:not(.nu-timeline-indikator-inactive):first').addClass('nu-timeline-indikator-selected')
                                                                                  .siblings().removeClass('nu-timeline-indikator-selected');
            $('.nu-timeline-indikator').children('.nu-timeline-indikator-open').hide();
            $('.nu-timeline-indikator-first, .nu-timeline-indikator-last').show();




                 
         }

      } else if ( responsiveWidth > $(window).width() ){ //If mobile

         var headerOffsetY = $tlHeaderWrapper.offset().top + $tlHeaderWrapper.height() - 50;
         var bottomOffsetY = $tlBottom.offset().top;

         if ( $(this).scrollTop() > headerOffsetY && $(this).scrollTop() < bottomOffsetY) { 

              makeMobileStickyheader();

              if (!responsiveStickyHeaderClosed){
                    $('#responsiveStickyHeader').show();
                   boolIngress = false;
             }

          } else if($(this).scrollTop() > bottomOffsetY){

              $('#responsiveStickyHeader').hide();
               responsiveStickyHeaderClosed = false;

          }else {

              $('#responsiveStickyHeader').hide();                 
              responsiveStickyHeaderClosed = false;
              $boolIngress = true;    
              fixHeaderSize();
             
           
          }
          

      }
       
    });

}//END func(scrollListener)

function previousArticle(){

    var $tlHendelse = $('.nu-timeline-hendelse').not('.nu-timeline-hendelse-inactive');

     if($(window).width() > responsiveWidth){

        if (fokusHendelse <= 0){
             return false;
        }
        
        var whereTo = fokusHendelse-1;
       
        $headerHeight = $tlHeader.height() + $('#smallHeader').height();
    
        //Animerer til forrige hendelse.. (Bruker animate istedenfor scrollTo pga .eq(), usikker på syntax med scrolLTo.)
        $('html, body').stop(true,false).animate({
                    scrollTop: $tlHendelse.eq(whereTo).offset().top - $headerHeight 
                     }, 400, 'easeOutCubic');
    }else{

        var $stickyHeaderHeight = $('#responsiveStickyHeader').height();
        var whereTo = fokusHendelse-1;
        
        $('html, body').stop(true, false).animate({
                   scrollTop: $tlHendelse.eq(whereTo).offset().top - $stickyHeaderHeight
         }, 400, 'easeOutCubic');
    }

}//END func(previousArticle)

function nextArticle(){



     //Hvis fokushendelsen er siste hendelse, skal det ikke skje noe når man trykker next.

     var $tlHendelse = $('.nu-timeline-hendelse').not('.nu-timeline-hendelse-inactive');

     if($(window).width() > responsiveWidth){ //If DESKTOP
        
        if (fokusHendelse == $tlHendelse.length - 1){
            
            return false;   
          
            
        }
        if ($boolIngress){ // Hvis vi er på første hendelse trengs det litt ekstra scrolling pga scrolleLytter.. 
           
            $headerHeight = $tlHeader.height() - ($tlHeaderIngress.height() + 25);
            var whereTo = fokusHendelse+1;
            
            $('html, body').stop(true, false).animate({
                       scrollTop: $tlHendelse.eq(whereTo).offset().top - $headerHeight 
             }, 400, 'easeOutCubic');
             
        }else{
            $headerHeight = $tlHeader.height() + $('#smallHeader').height();
            var whereTo = fokusHendelse+1;
            
            $('html, body').stop(true, false).animate({
                       scrollTop: $tlHendelse.eq(whereTo).offset().top - $headerHeight 
             }, 400, 'easeOutCubic');
        }

      }else{  //ELSE MOBILE

            if (fokusHendelse == $tlHendelse.length - 1){
            
              return false;   
              
            }
                
            var $stickyHeaderHeight = $('#responsiveStickyHeader').height();
            fokusHendelse++;
            
            $('html, body').stop(true, false).animate({
                       scrollTop: $tlHendelse.eq(fokusHendelse).offset().top - $stickyHeaderHeight
             }, 400, 'easeOutCubic');
            
        }
      
}//END func(nextArticle)

function initButtons(){
    
    $(document).on("click", ".nu-timeline-indikator:not(.nu-timeline-indikator-inactive)", function(){
        
        var $id = $(this).attr("data-date");   //Finds out what indicator that is clicked by getting the "data-date", and assign it as $id for later comparison.

        if ( $boolIngress ){

             $headerHeight = ($tlHeader.height() + $('#smallHeader').height()) - $tlHeaderIngress.height();
             $(window).scrollTo(".nu-timeline-hendelse[data-date='" + $id + "']", 400, {offset: -($headerHeight)});

        }else{

            $headerHeight = ($tlHeader.height() + $('#smallHeader').height());
            $(window).scrollTo(".nu-timeline-hendelse[data-date='" + $id + "']", 400, {offset: -($headerHeight)});
            
        }
      
    });//End indicator-click listender.
    
    $(document).on("click",".nu-timeline-prev", function(){
        previousArticle();      
    });

    $(document).on("click",".nu-timeline-next", function(){      
       nextArticle();
    });

    $('.nav-tabs a').click(function (e) {

        e.preventDefault();   //Prevent the viewport scrolling to href="#...".
        $(this).tab('show');  //Bootstrap show tab function.

        //If the tab contains a map, we have to resize this map since it has been hidden.
        if ($(this).attr('id') == "mapTab"){

          mapnumber = $(this).attr('tab-for-map');                              //Finding what map to resize
          google.maps.event.trigger(maparray[mapnumber], 'resize');             //Resizing the map
          maparray[mapnumber].setCenter(markerarray[mapnumber].getPosition());  //Centers the map
       
        }

        if ($(this).attr('id') == "pictureTab"){

          var whatSlider = $(this).attr("tab-for-slider");        //Which slider is in this tab-pane, since the slider was hidden it needs to be regenarated.         
          var swipeSliderObj = "swipeSlider" + whatSlider;        //Generates an object-variable.
          swipes[whatSlider] = new Swipe(window[swipeSliderObj]); //Puts the slider at same index in swipes[], and renders this slider once again.

        }
         
    });

    $('.nu-timeline-slider-fullscreen-btn').click(function(){
    
       $('#fullscreenSlider').show();

        var sliderHtml = $(this).siblings('div').clone();    //Copies the entire slider-div from the content and put it in the #fullscreenslider div.
        var whatSlider = $(this).attr('slider-to-expand');   //What slider do we want to fullscreen
        var currentPos = swipes[whatSlider].getPos();        //Gets the current picture from the little slider, so the fullscreen starts with the same picture when you click fullscreen.
        boolFullscreenSlider = true;                         //The slider is now fullscreen

        $('#fullscreenSlider').html(sliderHtml);          

        $('#fullscreenSlider .swipe-wrap .swipeSlideContent').removeAttr("style"); //Removes the dom-styling of the cloned elements.
        
        $('#fullscreenSlider .swipe-wrap').wrap("<div id='slider' class='swipe' ></div>"); //Wraps the slider with #slider

        //Makes the pictures in the slider appear in the middle of the screen.
        $('#fullscreenSlider .swipe-wrap .swipeSlideContent').each(function(){

              //Switched to css centering.
              /*var height = ($(window).height() - $(this).children('img').height());
              var newheight = height / 4;
              $(this).children('img').css("marginTop","" + newheight + "px");              
              */
               $(this).children('.nu-timeline-slider-image').height($(window).height()).width($(window).width());
        });

        var elem = document.getElementById('slider');
       
        //Makes the fullscreenslider as a new Swipe-object.
        window.slider = Swipe(elem, {
             startSlide: currentPos,
             callback: function(index, element) {
                $('#fullscreenSlider .nu-timeline-slider-tekst p').hide();
             },
             transitionEnd: function(index, element) {
                $('#fullscreenSlider .nu-timeline-slider-tekst p').fadeIn();              
             }
        });

        var numofslides = (window.slider.getNumSlides());
                
        //Adds next/prev buttons and close button.
        $('#slider').append("<div class='nu-timeline-slider-fullscreen-close'></div>");
        
       if (numofslides > 1){
          $('#slider').append("<a class='nu-timeline-slider-control left' onclick='slider.prev()' data-slide='prev'></a><a class='nu-timeline-slider-control right' onclick='slider.next()' data-slide='next'></a>");
        }
    });
    
    //When fullscreenslider is clicked it closes
    $('#fullscreenSlider').click(function(e){ 

         var clickedClasses = e.target.className.split(" "); //The classes of the element clicked(May be the next/prev buttons)
       
         //Loops through the classes and finds out if an overlaying button child of fullscreenslider is clicked, if so we dont want the fullscreen to close.
         for (var i = 0; i < clickedClasses.length; i++){

            if (clickedClasses[i] == 'nu-timeline-slider-control'){             
            
              return;

            } else if (clickedClasses[i] == ''){                    
              
              return;

            }
          }

          boolFullscreenSlider = false;
          $('#fullscreenSlider').empty().fadeOut(); //Empty the fullscreenslider so its ready for a new, and make it unvisible.

    });
    $(document).on("click",'.responsiveStickyheaderClose', function(){      
      $('#responsiveStickyHeader').fadeOut();
      responsiveStickyHeaderClosed = true;
    });

}//END func(initButtons)

function printIndicators(datoArray, importantDates, custom_time, categories){
 


    var thisTime = new Date(0,0,0); //This date has to be earlier than the first content_date of timeline
    var prevTime = new Date();      //Todays date
    
    for (var i = 0; i < datoArray.length; i++){
        
        //Finds the earliest date of this timeline
        if(datoArray[i].getTime() < prevTime.getTime()){
            prevTime = datoArray[i];
        };
        //Finds the last date of this timeline
        if(datoArray[i].getTime() > thisTime.getTime()){
            thisTime = datoArray[i];
        };
    }
        
    //Calculating the difference between first and last date in days.
    var dager = (thisTime.getTime() - prevTime.getTime()) / (1000*60*60*24);
    
    for (var i = 0; i < datoArray.length; i++){
        
        //Finds milliseconsd from this date(i), to the first date of the timeline. 
        var tidsaspekt_milli = datoArray[i].getTime() - prevTime.getTime();
        
        //Converts milliseconds to days
        var tidsaspekt_dager = (tidsaspekt_milli / (1000*60*60*24));
        
        //Finds the percent of this date compared to the entire timeaspect.
        var prosent = ((tidsaspekt_dager / dager) * 100).toFixed(2);
        
        //Formats the Date to: dd-mm-yyyy
        var datoFormatert = datoArray[i].getDate().toString() + "-" + datoArray[i].getMonth().toString() + "-" + datoArray[i].getFullYear().toString();
        
        //A class that represent important date is added if its important
        var importantClass = "";
        if (importantDates[i] == "Ja")
        {        
            importantClass = "nu-timeline-indikator-important";
        }

        //The datetooltip contains either the actual date, or a custom date if defined.
        var dateToolTip = "";
        var customDate = "";

        if (custom_time[i] == 0 || custom_time[i] == null || custom_time[i] == ""){
            dateToolTip += "<p>" + datoArray[i].getDate().toString() + ". " +norwegian_month_short[datoArray[i].getMonth()]  + ". " + datoArray[i].getFullYear().toString() + "</p>";
            customDate = "";
        }else{
            dateToolTip += "<p>" + custom_time[i] + "</p>";
            customDate = custom_time[i];
         
        }
     
        //Appends #indikatorWrapper with an indicatorDiv that gets it's percent of the time-aspect in left-positioning.
        $("#nu-timeline-indikator-wrapper2 .indicatorSuperWrap").append("<div data-date='" + datoFormatert + " " + datoArray[i].getHours().toString() + " " + datoArray[i].getMinutes().toString() + "' class='nu-timeline-indikator " + importantClass + "' data-date-percent='"
                                                                 + prosent + "' data-category='"+ categories[i] + "' data-custom-date='" + customDate + "'><div class='nu-timeline-indikator-open' data-date-percent='" + prosent + "'>" + dateToolTip + "</div></div>");

        //Sets css-property left for the indicators in percent.
        $(".nu-timeline-indikator[data-date-percent='" + prosent + "']").css({left: prosent + "%" });

        //The first and last date will be shown by default.
        if (i == 0){
            $(".nu-timeline-indikator-open[data-date-percent='" + prosent + "']").show();
            $(".nu-timeline-indikator-open[data-date-percent='" + prosent + "']").addClass('nu-timeline-indikator-first');
            $('.mobileFirstDate').html(dateToolTip);
        }
        if (i == datoArray.length - 1){
            $(".nu-timeline-indikator-open[data-date-percent='" + prosent + "']").show();
            $(".nu-timeline-indikator-open[data-date-percent='" + prosent + "']").addClass('nu-timeline-indikator-last');
            $('.mobileLastDate').html(dateToolTip);

        }

        // If the indicator is at the edge of wrapper, we need to position the viewable date so it doesnt overflow the edge of wrapper.
        if(prosent < 5){           
             $(".nu-timeline-indikator-open[data-date-percent='" + prosent + "']").css({"text-align":"left","margin-left":"0","background-position":"5px 16px" });
        }else if(prosent > 95){
             $(".nu-timeline-indikator-open[data-date-percent='" + prosent + "']").css({"text-align":"right","margin-left":"0","right":"0","background-position":"93px 16px" });
        }
    }//End (for-loop)

    //The first indicator should be selected by default.
    $('.nu-timeline-indikator:first').addClass("nu-timeline-indikator-selected"); //TRENGS VEL EGENTLIG IKKE?

}//END func(printIndicators)
    
function checkNav(){

    var $tlHendelse = $('.nu-timeline-hendelse:not(.nu-timeline-hendelse-inactive)');

    if(fokusHendelse == 0){

         $('.nu-timeline-prev').addClass('disabled');

    }else if(fokusHendelse == $tlHendelse.length - 1){

        $('.nu-timeline-next').addClass('disabled');

    }else {

         $('.nu-timeline-prev, .nu-timeline-next').removeClass('disabled');
      
    }  

}//END func(checkNav)

function keyboardListener(){

    $(document).bind('keydown',function(evt) {

        switch(evt.keyCode) {

            case 39:
                        nextArticle();
                        break;
            case 40:     
                        //Arrow-down
                        //nextArticle();
                        break;
            case 32:    
                        evt.preventDefault(); //Default space-keydown will jump down the document. Prevent this.
                        nextArticle();
                        break;
            case 37:
                        previousArticle();
                        break;

            case 38:   
                        //arrow-up
                        // previousArticle();
                        break;

            case 8:    previousArticle();
                        break;
            }
    }); 

}//END func(keyboardListener)

function wrapTxt(text, tag){
    // Wrap-funksjon for å forenkle konstruksjon av HTML-string fra json
    return "<" + tag + ">" + text + "</" + tag + ">";   

}//END func(wrapTxt)

function shallWeZoom(){
    
  var percentArray = [];

    $('.nu-timeline-indikator').each(function(e,x){
        //alert($(this).attr("data-date-percent"));
        var prosenten = $(this).attr("data-date-percent");
        var heltall = prosenten.split(".");
        percentArray.push(heltall[0]);

       // $.each(percentArray, function(i,x){
           
            if(percentArray[e-1] == heltall[0]){
                //alert("oi " + percentArray[e]);  
                $('#nu-timeline-indikator-wrapper2').width("5000px"); 
            }
        //})
    });

    var flytt=1;
    $('.move').click(function(){
        flytt -= 50;
        $('#nu-timeline-indikator-wrapper2').css("margin-left",flytt + "px");
    });
}
