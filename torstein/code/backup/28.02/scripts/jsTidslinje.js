var jsonPrototype = [
  {
    "content_ID": "5",
    "tl_ID": "1",
    "content_time": "17:21:00",
    "content_date": "2012-12-23",
    "content_title": "Gruppe 21 er awesome",
    "content_content": "Donizzle shiznit auctizzle shiz. Phasellizzle funky fresh elit ut nibh pretium tincidunt. Uhuh ... yih! a erat. Vestibulizzle izzle uhuh ... yih! sed maurizzle i saw beyonces tizzles and my pizzle went crizzle tristique. Mah nizzle izzle phat sizzle amet eros shizznit porta. Yippiyo velizzle tortor, ultricizzle shiznit, hendrerizzle bow wow wow, adipiscing quis, hizzle. Shit velizzle sizzle, aliquam dang, pharetra dizzle, dictizzle bow wow wow, turpizzle.",
    "content_category": "test",
    "content_media_type": "pictures",
    "content_media":[{  
                        "title":"picture 1",
                        "text":"Donizzle shiznit auctizzle shiz. Phasellizzle funky fresh elit ut nibh pretium tincidunt. Uhuh ... yih!",
                        "data":"http:\/\/www.acuteaday.com\/blog\/wp-content\/uploads\/2011\/09\/epic-horse-running.jpg"
                     },{
                        "title":"picture 2",
                        "text":"Bla2 bla2 bla2",
                        "data":"http:\/\/whateverblog.dallasnews.com\/files\/2012\/12\/Grumpy-Cat-MEME-01.jpg"
                     },{
                        "title":"picture 3",
                        "text":"Bla2 bla2 bla2",
                        "data":"http://static.ddmcdn.com/gif/ice-ice-babies-pictures-1.jpg"
                     },{
                        "title":"picture 4",
                        "text":"Bla2 bla2 bla2",
                        "data":"http://i.telegraph.co.uk/multimedia/archive/02371/potd-otter_2371254k.jpg"
                     },{
                        "title":"picture 5",
                        "text":"Bla2 bla2 bla2",
                        "data":"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcS_BTmDysTq8LVHhM20kZJAYSOCMhHd3-2SdOVzgya2dDHI_dpEOg"
                     }]
  },
  {
    "content_ID": "1",
    "tl_ID": "1",
    "content_time": "16:00:00",
    "content_date": "2013-01-17",
    "content_title": "Quick brown fox",
    "content_content": "Egyptian riot police clashing with Christians in front of the Coptic Orthodox church in Alexandria on Jan. 1, 2011. A car bombing outside the church killed 21 people. Although many still think of Egypts revolution - and the Arab Spring - as a sudden phenomenon that began in Tunisia, several smaller protests over the past decade helped fuel the movement that reached critical mass last January. One such episode was the bombing of a church in Alexandria on Jan. 1 that killed 21 and injured nearly 100 more. In Egypt, many believed the attack was started by the government to incite anger between Muslims and Christians. (An investigation is still under way).",
    "content_category": "test",
    "content_media_type": "map",
    "content_media":[{  "title":"Kartoverskrift",
                        "text":"Og en skikkelig interessant tekst",
                        "data":"59.91182,10.73427,16"
                     }]
   
  },
  {
    "content_ID": "2",
    "tl_ID": "1",
    "content_time": "16:00:00",
    "content_date": "2013-01-18",
    "content_title": "Test2",
    "content_content": "Lorem ipsum dolor sit amet, consectetuer adipiscing elit, sed diam nonummy nibh euismod tincidunt ut laoreet dolore magna aliquam erat volutpat. Ut wisi enim ad minim veniam, quis nostrud exerci tation ullamcorper suscipit lobortis nisl ut aliquip ex ea commodo consequat. Duis autem vel eum iriure dolor in hendrerit in vulputate velit esse molestie consequat, vel illum dolore eu feugiat nulla facilisis at vero eros et accumsan et iusto odio dignissim qui blandit praesent luptatum zzril delenit augue duis dolore te feugait nulla facilisi. Nam liber tempor cum soluta nobis eleifend option congue nihil imperdiet doming id quod mazim placerat facer possim assum. Typi non habent claritatem insitam; est usus legentis in iis qui facit eorum claritatem. Investigationes demonstraverunt lectores legere me lius quod ii legunt saepius. Claritas est etiam processus dynamicus, qui sequitur mutationem consuetudium lectorum. Mirum est notare quam littera gothica, quam nunc putamus parum claram, anteposuerit litterarum formas humanitatis per seacula quarta decima et quinta decima. Eodem modo typi, qui nunc nobis videntur parum clari, fiant sollemnes in futurum.",
    "content_category": "test",
    "content_media_type":"video",
    "content_media":[{
                        "title":"",
                        "text":"",
                        "data":""
    				}]
  },
  {
    "content_ID": "3",
    "tl_ID": "1",
    "content_time": "13:00:00",
    "content_date": "2013-01-25",
    "content_title": "Test2",
    "content_content": "Lorem ipsum dolor sit amet, consectetuer adipiscing elit, sed diam nonummy nibh euismod tincidunt ut laoreet dolore magna aliquam erat volutpat. Ut wisi enim ad minim veniam, quis nostrud exerci tation ullamcorper suscipit lobortis nisl ut aliquip ex ea commodo consequat. Duis autem vel eum iriure dolor in hendrerit in vulputate velit esse molestie consequat, vel illum dolore eu feugiat nulla facilisis at vero eros et accumsan et iusto odio dignissim qui blandit praesent luptatum zzril delenit augue duis dolore te feugait nulla facilisi. Nam liber tempor cum soluta nobis eleifend option congue nihil imperdiet doming id quod mazim placerat facer possim assum. Typi non habent claritatem insitam; est usus legentis in iis qui facit eorum claritatem. Investigationes demonstraverunt lectores legere me lius quod ii legunt saepius. Claritas est etiam processus dynamicus, qui sequitur mutationem consuetudium lectorum. Mirum est notare quam littera gothica, quam nunc putamus parum claram, anteposuerit litterarum formas humanitatis per seacula quarta decima et quinta decima. Eodem modo typi, qui nunc nobis videntur parum clari, fiant sollemnes in futurum. Lorem ipsum dolor sit amet, consectetuer adipiscing elit, sed diam nonummy nibh euismod tincidunt ut laoreet dolore magna aliquam erat volutpat. Ut wisi enim ad minim veniam, quis nostrud exerci tation ullamcorper suscipit lobortis nisl ut aliquip ex ea commodo consequat. Duis autem vel eum iriure dolor in hendrerit in vulputate velit esse molestie consequat, vel illum dolore eu feugiat nulla facilisis at vero eros et accumsan et iusto odio dignissim qui blandit praesent luptatum zzril delenit augue duis dolore te feugait nulla facilisi. Nam liber tempor cum soluta nobis eleifend option congue nihil imperdiet doming id quod mazim placerat facer possim assum. Typi non habent claritatem insitam; est usus legentis in iis qui facit eorum claritatem. Investigationes demonstraverunt lectores legere me lius quod ii legunt saepius. Claritas est etiam processus dynamicus, qui sequitur mutationem consuetudium lectorum. Mirum est notare quam littera gothica, quam nunc putamus parum claram, anteposuerit litterarum formas humanitatis per seacula quarta decima et quinta decima. Eodem modo typi, qui nunc nobis videntur parum clari, fiant sollemnes in futurum.",
    "content_category": "test",
    "content_media_type":"map",
    "content_media":[{
                        "title":"Zumhin",
                        "text":"Zumthing else",
                        "data":"59.94124, 10.50125, 15"
    				}]
   },
  {
    "content_ID": "4",
    "tl_ID": "1",
    "content_time": "13:00:00",
    "content_date": "2013-01-27",
    "content_title": "Test2",
    "content_content": "Lorem ipsum dolor sit amet, consectetuer adipiscing elit, sed diam nonummy nibh euismod tincidunt ut laoreet dolore magna aliquam erat volutpat. Ut wisi enim ad minim veniam, quis nostrud exerci tation ullamcorper suscipit lobortis nisl ut aliquip ex ea commodo consequat. Duis autem vel eum iriure dolor in hendrerit in vulputate velit esse molestie consequat, vel illum dolore eu feugiat nulla facilisis at vero eros et accumsan et iusto odio dignissim qui blandit praesent luptatum zzril delenit augue duis dolore te feugait nulla facilisi. Nam liber tempor cum soluta nobis eleifend option congue nihil imperdiet doming id quod mazim placerat facer possim assum. Typi non habent claritatem insitam; est usus legentis in iis qui facit eorum claritatem. Investigationes demonstraverunt lectores legere me lius quod ii legunt saepius. Claritas est etiam processus dynamicus, qui sequitur mutationem consuetudium lectorum. Mirum est notare quam littera gothica, quam nunc putamus parum claram, anteposuerit litterarum formas humanitatis per seacula quarta decima et quinta decima. Eodem modo typi, qui nunc nobis videntur parum clari, fiant sollemnes in futurum. Lorem ipsum dolor sit amet, consectetuer adipiscing elit, sed diam nonummy nibh euismod tincidunt ut laoreet dolore magna aliquam erat volutpat. Ut wisi enim ad minim veniam, quis nostrud exerci tation ullamcorper suscipit lobortis nisl ut aliquip ex ea commodo consequat. Duis autem vel eum iriure dolor in hendrerit in vulputate velit esse molestie consequat, vel illum dolore eu feugiat nulla facilisis at vero eros et accumsan et iusto odio dignissim qui blandit praesent luptatum zzril delenit augue duis dolore te feugait nulla facilisi. Nam liber tempor cum soluta nobis eleifend option congue nihil imperdiet doming id quod mazim placerat facer possim assum. Typi non habent claritatem insitam; est usus legentis in iis qui facit eorum claritatem. Investigationes demonstraverunt lectores legere me lius quod ii legunt saepius. Claritas est etiam processus dynamicus, qui sequitur mutationem consuetudium lectorum. Mirum est notare quam littera gothica, quam nunc putamus parum claram, anteposuerit litterarum formas humanitatis per seacula quarta decima et quinta decima. Eodem modo typi, qui nunc nobis videntur parum clari, fiant sollemnes in futurum.",
    "content_category": "test",
    "content_media_type":"pictures",
    "content_media":[{
                        "title":"something",
                        "text":"Text about something",
                        "data":"http://allfinearts.com/wp-content/uploads/2007/12/beautiful-2ddrawings-2d39.jpg"
    				},
    				{
                        "title":"something2",
                        "text":"Text about something2",
                        "data":"https://encrypted-tbn2.gstatic.com/images?q=tbn:ANd9GcR8JBTULppKhqlY3vp3eJbc_rEpPaRjbL7wYYTxNO77SNy1yglW"
    				}]
   },
  {
    "content_ID": "5",
    "tl_ID": "1",
    "content_time": "13:00:00",
    "content_date": "2013-02-29",
    "content_title": "Test2",
    "content_content": "Lorem ipsum dolor sit amet, consectetuer adipiscing elit, sed diam nonummy nibh euismod tincidunt ut laoreet dolore magna aliquam erat volutpat. Ut wisi enim ad minim veniam, quis nostrud exerci tation ullamcorper suscipit lobortis nisl ut aliquip ex ea commodo consequat. Duis autem vel eum iriure dolor in hendrerit in vulputate velit esse molestie consequat, vel illum dolore eu feugiat nulla facilisis at vero eros et accumsan et iusto odio dignissim qui blandit praesent luptatum zzril delenit augue duis dolore te feugait nulla facilisi. Nam liber tempor cum soluta nobis eleifend option congue nihil imperdiet doming id quod mazim placerat facer possim assum. Typi non habent claritatem insitam; est usus legentis in iis qui facit eorum claritatem. Investigationes demonstraverunt lectores legere me lius quod ii legunt saepius. Claritas est etiam processus dynamicus, qui sequitur mutationem consuetudium lectorum. Mirum est notare quam littera gothica, quam nunc putamus parum claram, anteposuerit litterarum formas humanitatis per seacula quarta decima et quinta decima. Eodem modo typi, qui nunc nobis videntur parum clari, fiant sollemnes in futurum. Lorem ipsum dolor sit amet, consectetuer adipiscing elit, sed diam nonummy nibh euismod tincidunt ut laoreet dolore magna aliquam erat volutpat. Ut wisi enim ad minim veniam, quis nostrud exerci tation ullamcorper suscipit lobortis nisl ut aliquip ex ea commodo consequat. Duis autem vel eum iriure dolor in hendrerit in vulputate velit esse molestie consequat, vel illum dolore eu feugiat nulla facilisis at vero eros et accumsan et iusto odio dignissim qui blandit praesent luptatum zzril delenit augue duis dolore te feugait nulla facilisi. Nam liber tempor cum soluta nobis eleifend option congue nihil imperdiet doming id quod mazim placerat facer possim assum. Typi non habent claritatem insitam; est usus legentis in iis qui facit eorum claritatem. Investigationes demonstraverunt lectores legere me lius quod ii legunt saepius. Claritas est etiam processus dynamicus, qui sequitur mutationem consuetudium lectorum. Mirum est notare quam littera gothica, quam nunc putamus parum claram, anteposuerit litterarum formas humanitatis per seacula quarta decima et quinta decima. Eodem modo typi, qui nunc nobis videntur parum clari, fiant sollemnes in futurum.",
    "content_category": "test",
    "content_media_type":"pictures",
    "content_media":[{
                        "title":"something else",
                        "text":"Text about something else",
                        "data":""
    				}]
   }];


//Script start

// Variablene under brukes gjentatte ganger i scritpet.

var fokusHendelse = 0;		//Representerer indexen av hendelsen leseren leser
var $headerHeight = 0;		//Headeren har dynamisk høyde, og vi trenger høyden flere ganger for å scrolle riktig ved event.
var $ingressHeight = 0;		//Brukes for å finne ut høyden på header uten ingress-tekst.
var $boolIngress = true;	//True = Ingressteksten er synlig.
var kart = false; 			//Er det et kart i tidslinjen? 

//Array for å få norske månedsnavn
var norwegian_month=new Array();
	norwegian_month[0]="januar";
	norwegian_month[1]="februar";
	norwegian_month[2]="mars";
	norwegian_month[3]="april";
	norwegian_month[4]="mai";
	norwegian_month[5]="juni";
	norwegian_month[6]="juli";
	norwegian_month[7]="august";
	norwegian_month[8]="september";
	norwegian_month[9]="oktober";
	norwegian_month[10]="november";
	norwegian_month[11]="desember";


//jQuery selectors som brukes gjentatte ganger.
var $tlWrapper = $(".nu-timeline-wrapper");
var $tlHeader = $("#nu-timeline-header");
var $tlHeaderWrapper = $('.nu-timeline-header-wrapper');
var $tlHeaderIngress = $('#nu-timeline-ingress');
var $tlHendelse = $('.nu-timeline-hendelse');



$(document).ready(function (){

	$headerHeight = $tlHeader.height();
	$tlHeaderWrapper.height($headerHeight + 25);
	$ingressHeight =  $tlHeaderIngress.height();
	
	//Foreløpig løsning for reponsivt design: Fixed-div 100%.
	var $headerWidth = $tlWrapper.width();
	$tlHeaderWrapper.width($headerWidth);

	
	windowResizeListener();
	scrolleLytter();
    //hentJSONTekst();
	hentDataPrototype();
	knappeKlargjøring();
    makeBottomSpace();      //Makes some space on the bottom of timeline, so you can scroll to the last event */
	startSliders();

	//$("img.lazy").lazyload(); Måtte kommentere ut pga scrollingen fikk feil offset når bilder var inaktive.

});

function windowResizeListener() {
    $(window).resize(function (){
            //Foreløpig løsning for reponsivt design: Fixed-div 100%.
            var $desiredHeaderWidth = $tlWrapper.width();
            $tlHeaderWrapper.width($desiredHeaderWidth);
            $tlHeader.width($desiredHeaderWidth);
            
            //Høyden på header
            //Sørger for at .headerWrapper får en fast høyde, 
            //slik at contentdivisjoner under flyter under stickyheader.
            $headerHeight = $tlHeader.height();
            $tlHeaderWrapper.height($headerHeight);
            
    });
}

function makeBottomSpace() {
    var $windowHeight = $(window).height();
    var lastHendelse = $('.nu-timeline-hendelse:last').height();
    $('.nu-timeline-bottom-pusher').height($windowHeight - lastHendelse); 
}

function scrolleLytter() {
	
    //Lytter til scrollehjulet, og tar vekk ingresstekst om man scroller nedover. + visa versa
	$(window).scroll(function () {
		var $tlHendelse = $('.nu-timeline-hendelse');
        //var $timelineTop = $('.header').position().top; // Brukes ikke?
       	$headerHeight = $tlHeader.height();
         //Med Waypoint(jquery plugin), ser koden hvilken hendelse som er i viewport og markerer tilsvarende indikator.    
		$tlHendelse.waypoint(function(direction) {
		    fokusHendelse = $tlHendelse.index(this);  
			  
		    $(".nu-timeline-indikator").eq(fokusHendelse).addClass("nu-timeline-indikator-selected").siblings().removeClass("nu-timeline-indikator-selected");
		},{
		    offset: $headerHeight + 10,
		    horizontal: false
		});  
		    
		sjekkNav();

		var headerOffsetY = ($tlHeaderWrapper.offset().top);
		
		if ($(this).scrollTop() > headerOffsetY) {
			
			$tlHeader.css("position","fixed");

			$('#nu-timeline-ingress').slideUp(260,function() {
				$boolIngress = false;
			});

			

		} else {

			$tlHeader.css("position","relative");
			$('#nu-timeline-ingress').slideDown(260,function() {
				$headerHeight = $tlHeader.height();
				$tlHeaderWrapper.height($headerHeight);
				$boolIngress = true;
				
          });
		}

	});
}

function knappeKlargjøring(){
	//Bruker .on("click", ".ind... ) istedenfor live() som ble fjernet i jquery v1.9. 
	$(document).on("click", ".nu-timeline-indikator", function(){
		//finner ut hvilken kindikator som er trykket på, og scroller til tilsvarende hendelse
		var $id = $(this).attr("id");
		
		if ($boolIngress){
			$headerHeight = $tlHeader.height() - ($tlHeaderIngress.height());
			$(window).scrollTo("." + $id, 300, {offset: -$headerHeight});
		}else{
			$(window).scrollTo("." + $id, 300, {offset: -$headerHeight });
		}
		
	});
	
	$("#nu-timeline-prev").click(function(){
      var $tlHendelse = $('.nu-timeline-hendelse');
		if (fokusHendelse == 0){
             return false;
        }
        
		fokusHendelse--;
		$headerHeight = $tlHeader.height();
	
		//Animerer til forrige hendelse.. (Bruker animate istedenfor scrollTo pga .eq(), usikker på syntax med scrolLTo.)
		$('html, body').animate({
                    scrollTop: $tlHendelse.eq(fokusHendelse).offset().top - $headerHeight
                     }, 200);
		//Setter css .indikatorSelected på riktig indikator.			 
		//$('.indikator').eq(fokusHendelse).addClass("indikatorSelected").siblings().removeClass("indikatorSelected");	
	});

	$("#nu-timeline-next").click(function($tlHendelse){
		//Hvis fokushendelsen er siste hendelse, skal det ikke skje noe når man trykker next.
        var $tlHendelse = $('.nu-timeline-hendelse');
	    if (fokusHendelse == $tlHendelse.length - 1){
			
            return false;   
			
        }else if ($boolIngress){ // Hvis vi er på første hendelse trengs det litt ekstra scrolling pga scrolleLytter.. 
			
			$headerHeight = $tlHeader.height() - ($tlHeaderIngress.height() + 15);
			fokusHendelse++;
			
			$('html, body').animate({
					   scrollTop: $tlHendelse.eq(fokusHendelse).offset().top - $headerHeight
			 }, 200);
			 
		}else{
			$headerHeight = $tlHeader.height();
			fokusHendelse++;
			
			$('html, body').animate({
					   scrollTop: $tlHendelse.eq(fokusHendelse).offset().top - $headerHeight
			 }, 200);
		}
	});
}

function leggTilIndikatorer(datoArray){
	
	var thisTime = new Date(0,0,0); //En dato som garantert er før første hendelse i tidslinjen.
	var prevTime = new Date(); //Dagens dato
	
	for (var i = 0; i < datoArray.length; i++){
		
		//Finner første dato i hendelseforløp.
		if(datoArray[i].getTime() < prevTime.getTime()){
			prevTime = datoArray[i];
		};
		//Finner siste dato i hendelseforløp.
		if(datoArray[i].getTime() > thisTime.getTime()){
			thisTime = datoArray[i];
		};
	}
		
	//Regner om differansen til første og siste dato i dager
	var dager = (thisTime.getTime() - prevTime.getTime()) / (1000*60*60*24);
	
	for (var i = 0; i < datoArray.length; i++){
		
	    //Finner millisekunder fra dato(this) til første hendelsesdato.
		var tidsaspekt_milli = datoArray[i].getTime() - prevTime.getTime();
		
		//Gjør om fra millisekunder til dager.
		var tidsaspekt_dager = (tidsaspekt_milli / (1000*60*60*24));
		
		//Finner prosenten til dato(this) i forhold til hele tidsaspektet.
		var prosent = ((tidsaspekt_dager / dager) * 100).toFixed(0);
		
		//Formaterer Datoen til format: dd-mm-yyyy
		var datoFormatert = datoArray[i].getDate().toString() + "-" + datoArray[i].getMonth().toString() + "-" + datoArray[i].getFullYear().toString();
		
		//Appenderer #indikatorWrapper med indikatordiv som får en venstremargin med riktig prosent i forhold til tidsaspektet.
		$("#nu-timeline-indikator-wrapper").append("<div id='" + datoFormatert + "'class='nu-timeline-indikator " + prosent + "'></div>");
		$("." + prosent + "").css({left: prosent + "%" });
	};
	
	//Setter .indikatorSeleected på første indikator.
	$('.nu-timeline-indikator:first').addClass("nu-timeline-indikator-selected"); //TRENGS VEL EGENTLIG IKKE?
}

function hentData(){
	//Loading-gif før data blir skrevet ut til .hendelseWrapper.
	$('.nu-timeline-hendelse-wrapper').html("<img id='nu-timeline-loading' src='gfx/loading2.gif' alt='Laster tidslinje...' />");
	
	var url = 'http://www.svendsen-it.no/hovedprosjekt/htdocs/testJson.php?tidslinje=1';
	var prototypeUrl = jsonPrototype;
	$.support.cors = true
	$.ajaxSetup({
		async: false
		/* cache:false MAYBE LATER? */
	});
	
	$.getJSON(prototypeUrl, function(jsonData){
		
		var htmlTxt = ""; //Gjør klar streng som skal inneholde HTML-text.
		var datoArray = []; //Gjør klar array som skal samle på datoene.
		
		$.each(jsonData, function(i,item){
			
			var content_id = item.content_ID;
			var table_id = item.tl_ID;
			var title = item.content_title;
			var time = item.content_time;
			var date = item.content_date;
			var content = item.content_content;
			var category = item.content_category;
			var mapLat = item.content_mapLat;
			var mapLng = item.content_mapLng;
			var zoomLvl = item.content_zoomLvl;
			var picId = item.pic_ID;
			var picPath = item.pic_path;
			
			var date_splittet_opp = date.split("-");
			var nytt_format_dato = "";
			
			//Må forandre formatet "mm-dd-yyyy" til "mm/dd/yyyy" for at IE8 skal godta syntaxen til et nytt Dateobjekt.
			for (var i = 0; i < date_splittet_opp.length; i++) {
				nytt_format_dato += date_splittet_opp[i] + "/";
			}

			var hendelseDato = new Date(nytt_format_dato); //Lager Date-objekt av datoen.
			datoArray.push(hendelseDato); //Legger hver dato i en array
			
			//Lager en formatert dato som skal legges til som klassenavn til (this)div.hendelse. 
			//Indikatorne vil få denne datoen som ID i LeggTilindikatorer().
			// Klikker man på en indikator, vil siden scrolle til den div.hendelse som har samme klasse som indikator har som id.
			var datoFormatert = hendelseDato.getDate().toString() + "-" + hendelseDato.getMonth().toString() + "-" + hendelseDato.getFullYear().toString();
			
			htmlTxt += "<div class='nu-timeline-hendelse " + datoFormatert + "'>";
			htmlTxt += 		"<div class='nu-timeline-hendelse-tid'>";
			htmlTxt += 			"<h2>" + hendelseDato.getDate().toString() + ". " + norwegian_month[hendelseDato.getMonth()] + " " + hendelseDato.getFullYear().toString() + "</h2>";
			htmlTxt += 		"</div>"
			htmlTxt += 		"<div class='nu-timeline-hendelse-innhold'>"
			htmlTxt += 			"<div class='nu-timeline-hendelse-media'><img src='"+picPath+"' alt /></div>";
			htmlTxt += 	    	"<div class='nu-timeline-hendelse-story'><h2>" + title + "</h2>";
			htmlTxt +=			"";
            htmlTxt +=          wrapTxt(content, "p");
			htmlTxt += "</div></div></div><div class='nu-timeline-clearFix'></div>";
			
		});
		
		$('.nu-timeline-hendelse-wrapper').html(htmlTxt); //Skriver ut strengen htmlTxt.

		leggTilIndikatorer(datoArray); //Funksjon med array som parameter.
	})
	.complete (function(jsonStatus){
		//?
	})
	.error (function(jsonStatus){
		alert(":(");
	});
	
}

// Henter data fra json, omgjør det til en lesbar string og legger den til #sectData
function hentJSONTekst(){
	$.getJSON('http://www.svendsen-it.no/hovedprosjekt/htdocs/fetchToJson.php?id=2', function(jsonData){
		var jsonString = JSON.stringify(jsonData);
					
		$('.nu-timeline-hendelse-wrapper').html("<xmp>" + jsonString + "</xmp>");
	})
	.error(function(jsonStatus){
		alert(JSON.stringify(jsonStatus));
	});
}
    
function sjekkNav(){
	var $tlHendelse = $('.nu-timeline-hendelse');

     if(fokusHendelse == 0){
		 $('#nu-timeline-prev').addClass('disabled');
		
    }else if(fokusHendelse == $tlHendelse.length - 1){
        $('#nu-timeline-next').addClass('disabled');
    }else {
         $('#nu-timeline-prev, #nu-timeline-next').removeClass('disabled');
      
    }   
}
// Wrap-funksjon for å forenkle konstruksjon av HTML-string fra json
function wrapTxt(text, tag){
	return "<" + tag + ">" + text + "</" + tag + ">";	
}
	
function hentDataPrototype(){
	//Loading-gif før data blir skrevet ut til .hendelseWrapper.
	$('.nu-timeline-hendelse-wrapper').html("<img id='nu-timeline-loading' src='gfx/loading2.gif' alt='Laster tidslinje...' />");
	
	var prototypeUrl = jsonPrototype;
		
		var htmlTxt = ""; //Gjør klar streng som skal inneholde HTML-text.
		var datoArray = []; //Gjør klar array som skal samle på datoene.
		
		$.each(jsonPrototype, function(i,item){
			var content_id = item.content_ID;
			var table_id = item.tl_ID;
			var title = item.content_title;
			var time = item.content_time;
			var date = item.content_date;
			var content = item.content_content;
			var category = item.content_category;

			var mediatype = item.content_media_type;
			var mediacontent = item.content_media;
			var mediaHtml = printMedia(mediatype, mediacontent);

			var date_splittet_opp = date.split("-");
			var nytt_format_dato = "";
			//Må forandre formatet "mm-dd-yyyy" til "mm/dd/yyyy" for at IE8 skal godta syntaxen til et nytt Dateobjekt.
			for (var i = 0; i < date_splittet_opp.length; i++) {
				nytt_format_dato += date_splittet_opp[i] + "/";
			}
			var hendelseDato = new Date(nytt_format_dato); //Lager Date-objekt av datoen.
			datoArray.push(hendelseDato); //Legger hver dato i en array
			
			//Lager en formatert dato som skal legges til som klassenavn til (this)div.hendelse. 
			//Indikatorne vil få denne datoen som ID i LeggTilindikatorer().
			// Klikker man på en indikator, vil siden scrolle til den div.hendelse som har samme klasse som indikator har som id.
			var datoFormatert = hendelseDato.getDate().toString() + "-" + hendelseDato.getMonth().toString() + "-" + hendelseDato.getFullYear().toString();
			
			htmlTxt += "<div class='nu-timeline-hendelse " + datoFormatert + "'>";
			htmlTxt += 		"<div class='nu-timeline-hendelse-tid'>";
			htmlTxt += 			"<h2>" + hendelseDato.getDate().toString() + ". " + norwegian_month[hendelseDato.getMonth()] + " " + hendelseDato.getFullYear().toString() + "</h2>";
			htmlTxt += 		"</div>"
			htmlTxt += 		"<div class='nu-timeline-hendelse-innhold'>"
			htmlTxt += 			mediaHtml;
			htmlTxt += 	    	"<div class='nu-timeline-hendelse-story'><h2>" + title + "</h2>";
			htmlTxt +=			"";
            htmlTxt +=          wrapTxt(content, "p");
			htmlTxt += "</div></div></div>";
			
		});
		
		$('.nu-timeline-hendelse-wrapper').html(htmlTxt); //Skriver ut strengen htmlTxt.
		
		if (kart){
						//Funksjon for IE8, for more visit: 
						//http://stackoverflow.com/questions/7410949/javascript-document-getelementsbyclassname-compatibility-with-ie
						function getElementsByClassName(node, classname) {
						    var a = [];
						    var re = new RegExp('(^| )'+classname+'( |$)');
						    var els = node.getElementsByTagName("*");
						    for(var i=0,j=els.length; i<j; i++)
						        if(re.test(els[i].className))a.push(els[i]);
						    return a;
						}//*FOR IE8

						maps = getElementsByClassName(document.body,'nu-timeline-map');

						for (var i = 0; i < maps.length; i++){
							
							var longitude = maps[i].getAttribute("data-map-longitude");
							var latitude = maps[i].getAttribute("data-map-latitude");
							var mapzoom = maps[i].getAttribute("data-map-zoom");
							//alert(hey);
							var map = new google.maps.Map(maps[i], {
						      zoom: parseInt(mapzoom),
						      center: new google.maps.LatLng(longitude,latitude),
						      mapTypeId: google.maps.MapTypeId.ROADMAP,
						      scrollwheel: false
						    });

						    var marker = new google.maps.Marker({
						        position: new google.maps.LatLng(longitude,latitude),
						        map: map
						    });

					    }
		}

		leggTilIndikatorer(datoArray); //Funksjon med array som parameter.


	
}
    
 function startSliders(){

 		$sliderWidth = $('.nu-timeline-slider').width();
		$('.nu-timeline-slides li').width($sliderWidth);

		$('ol.nu-timeline-slider-indikatorer li').click(function(){
			var whatSlider = $(this).attr('data-target');
			var slideToThis = $(this).attr("data-slide-to");		
			var newPosition = $(whatSlider + ' .nu-timeline-slides li').eq(slideToThis).position().left;
			//alert(-newPosition + " " + slideToThis);
			$(whatSlider + ' .nu-timeline-slides').animate({
				                    marginLeft: -($sliderWidth * slideToThis)
				             }, 200);
			
			$(whatSlider + ' ol.nu-timeline-slider-indikatorer li').eq(slideToThis).addClass('active').siblings().removeClass('active');
			$(whatSlider + ' ul.nu-timeline-slides li').eq(slideToThis).addClass('active').siblings().removeClass('active');

		 

			
		});

		$('a.nu-timeline-slider-control').click(function(){

			var whatSlider = "#" + $(this).siblings('.nu-timeline-slider').attr("id");
			var whatWay = $(this).attr('data-slide');
			var activeSlide = $(whatSlider + ' ul.nu-timeline-slides li.active').index();	

			switch (whatWay){
				case "prev": 
							if(activeSlide == 0){
								activeSlide = $(whatSlider + ' ul.nu-timeline-slides li').last().index();
							}else{
								activeSlide-=1;
							}
							$(whatSlider + ' .nu-timeline-slides').animate({
				                    marginLeft: -($sliderWidth * activeSlide)
				             }, 200);

							$(whatSlider + ' ol.nu-timeline-slider-indikatorer li').eq(activeSlide).addClass('active').siblings().removeClass('active');
							$(whatSlider + ' ul.nu-timeline-slides li').eq(activeSlide).addClass('active').siblings().removeClass('active');
							
							break;

				case "next": 
							if(activeSlide == $(whatSlider + ' ul.nu-timeline-slides li').last().index()){
								activeSlide = 0;
							}else{
								activeSlide+=1;
							}
							
							$(whatSlider + ' .nu-timeline-slides').animate({
				                    marginLeft: -($sliderWidth * activeSlide)
				             }, 200);
							
							$(whatSlider + ' ol.nu-timeline-slider-indikatorer li').eq(activeSlide).addClass('active').siblings().removeClass('active');
							$(whatSlider + ' ul.nu-timeline-slides li').eq(activeSlide).addClass('active').siblings().removeClass('active');

							break;
				default: 
							break;
			}
		
		});
 }


var sliderTeller = 0; 

function printMedia(mediatype, mediacontent){
	
	var mediaHtml = "";
	
	switch (mediatype)
	{
		case "pictures": 

						mediaHtml += "<div class='nu-timeline-hendelse-media'><div class='sliderWrapper'><div id='nu-timeline-slider-id-" + sliderTeller + "' class='nu-timeline-slider' >";
						

						//The indicators(coins)
						mediaHtml += "<ol class='nu-timeline-slider-indikatorer'>"
						var indikatorTeller = 0;
						for (var i = 0; i < mediacontent.length; i++){
							if(i == 0){
								mediaHtml += "<li data-target='#nu-timeline-slider-id-" + sliderTeller + "' data-slide-to='"+ indikatorTeller + "' class='active'> </li>";	
							}else{
								mediaHtml += "<li data-target='#nu-timeline-slider-id-" + sliderTeller + "' data-slide-to='"+ indikatorTeller + "'> </li>";	
							}
							indikatorTeller++;
						}
						mediaHtml += "</ol>";


						//The content of slideshow
						mediaHtml += "<ul class='nu-timeline-slides'>";
						for (var i = 0; i < mediacontent.length; i++){
							if(i == 0){
								mediaHtml += "<li class='active'><img src='" + mediacontent[i].data + "' alt='"+ mediacontent[i].title +"' /><p>"+ mediacontent[i].text + "</p></li>";	
							}else{
								mediaHtml += "<li><img src='" + mediacontent[i].data + "' alt='"+ mediacontent[i].title +"' /><p>"+ mediacontent[i].text + "</p></li>";	
							}
						}
						mediaHtml += "</ul>";

						//The prev/next buttons 
						


						//closing-tags for zhe parentz.
						mediaHtml += "</div>";
						mediaHtml += "<a class='nu-timeline-slider-control left'  data-slide='prev'></a>";
  						mediaHtml += "<a class='nu-timeline-slider-control right' data-slide='next'></a>";
						mediaHtml += "</div></div>";

						sliderTeller++;

						return mediaHtml;
					
		case "map": 
						kart= true;
						mediaHtml += "<div class='nu-timeline-hendelse-media'>";

						for (var i = 0; i < mediacontent.length; i++){
							var data_splitted = mediacontent[i].data.split(",");
							mediaHtml += "<div class='nu-timeline-map' data-map-longitude='"+data_splitted[0]+"' data-map-latitude='"+data_splitted[1]+"' data-map-zoom='"+data_splitted[2]+"'></div>";
						

						}
						mediaHtml += "</div>";

					


					
						//var mediacontent_splitted = mediacontent.data.split(",");
						
						


					    return mediaHtml;

		case "video": 
						mediaHtml += "<div class='nu-timeline-hendelse-media'><div id='embedPlayerHere'></div><script type='text/javascript' src='http://aftenposten.no/embed?id=7127472&width=480&height=270'></script></div>";
						return mediaHtml;
							break;
		
			default:   


							return "";


	}
}